(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Array=c.Array||{};e=c.String=c.String||{};f=c.List=c.List||{};g=c.Abbrev=c.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=b&&b.Obj;l=g.Slot=g.Slot||{};m=g.Async=g.Async||{};n=g.Mailbox=g.Mailbox||{};o=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};p=c.AppendList=c.AppendList||{};q=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};r=c.DomUtility=c.DomUtility||{};s=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};t=c.Trie=c.Trie||{};u=t.LookupResult=t.LookupResult||{};v=a.StartupCode$WebSharper_UI$Trie=a.StartupCode$WebSharper_UI$Trie||{};w=c.Snap=c.Snap||{};x=c.Var=c.Var||{};y=c.View=c.View||{};z=c.ConcreteVar=c.ConcreteVar||{};A=c.Var$1=c.Var$1||{};B=c.Updates=c.Updates||{};C=c.FromView=c.FromView||{};D=c.ViewBuilder=c.ViewBuilder||{};E=c.Submitter=c.Submitter||{};F=c.Key=c.Key||{};G=c.Model=c.Model||{};H=c.Serializer=c.Serializer||{};I=c.Storage=c.Storage||{};J=I.ArrayStorage=I.ArrayStorage||{};K=I.LocalStorageBackend=I.LocalStorageBackend||{};L=c.ListModel=c.ListModel||{};M=c.ListModels=c.ListModels||{};N=a.StartupCode$WebSharper_UI$Models=a.StartupCode$WebSharper_UI$Models||{};O=c.ReactiveExtensions=c.ReactiveExtensions||{};P=c.DoubleInterpolation=c.DoubleInterpolation||{};Q=c.Interpolation=c.Interpolation||{};R=c.Easing=c.Easing||{};S=c.Easings=c.Easings||{};T=c.An=c.An||{};U=c.Anims=c.Anims||{};V=c.Trans=c.Trans||{};W=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};X=b&&b.Web;Y=X&&X.Control;Z=c.OnAfterRenderControl=c.OnAfterRenderControl||{};_0=c.AnimatedAttrNode=c.AnimatedAttrNode||{};_1=c.DynamicAttrNode=c.DynamicAttrNode||{};_2=c.AttrProxy=c.AttrProxy||{};_3=c.Client=c.Client||{};_4=_3.Attrs=_3.Attrs||{};_5=_4.Dyn=_4.Dyn||{};_6=c.Attrs=c.Attrs||{};_7=c.CheckedInput=c.CheckedInput||{};_8=c.BindVar=c.BindVar||{};_9=c.AttrModule=c.AttrModule||{};_=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};$=c.TemplateHole=c.TemplateHole||{};ba=c.TemplateHoleModule=c.TemplateHoleModule||{};bb=ba.Elt=ba.Elt||{};bc=ba.Text=ba.Text||{};bd=ba.TextView=ba.TextView||{};be=ba.Attribute=ba.Attribute||{};bf=ba.Event=ba.Event||{};bg=ba.EventQ=ba.EventQ||{};bh=ba.EventE=ba.EventE||{};bi=ba.AfterRender=ba.AfterRender||{};bj=ba.AfterRenderQ=ba.AfterRenderQ||{};bk=ba.AfterRenderE=ba.AfterRenderE||{};bl=ba.VarStr=ba.VarStr||{};bm=ba.VarBool=ba.VarBool||{};bn=ba.VarDateTime=ba.VarDateTime||{};bo=ba.VarFile=ba.VarFile||{};bp=ba.VarDomElement=ba.VarDomElement||{};bq=ba.VarInt=ba.VarInt||{};br=ba.VarIntUnchecked=ba.VarIntUnchecked||{};bs=ba.VarFloat=ba.VarFloat||{};bt=ba.VarFloatUnchecked=ba.VarFloatUnchecked||{};bu=ba.VarDecimal=ba.VarDecimal||{};bv=ba.VarDecimalUnchecked=ba.VarDecimalUnchecked||{};bw=ba.UninitVar=ba.UninitVar||{};bx=X&&X.FSharpInlineControl;by=c.InlineControlWithPlaceHolder=c.InlineControlWithPlaceHolder||{};bz=_3.Settings=_3.Settings||{};bA=c.DocElemNode=c.DocElemNode||{};bB=_3.Docs=_3.Docs||{};bC=bB.DomNodes=bB.DomNodes||{};bD=bB.NodeSet=bB.NodeSet||{};bE=bB.RunState=bB.RunState||{};bF=c.Docs=c.Docs||{};bG=c.Doc=c.Doc||{};bH=c.Elt=c.Elt||{};bI=_3.EltUpdater=_3.EltUpdater||{};bJ=a.StartupCode$WebSharper_UI$Doc_Proxy=a.StartupCode$WebSharper_UI$Doc_Proxy||{};bK=_3.Templates=_3.Templates||{};bL=bK.Prepare=bK.Prepare||{};bM=a.StartupCode$WebSharper_UI$Templates=a.StartupCode$WebSharper_UI$Templates||{};bN=c.Flow=c.Flow||{};bO=c.FlowBuilder=c.FlowBuilder||{};bP=c.HtmlModule=c.HtmlModule||{};bQ=bP.attr=bP.attr||{};bR=c.Router=c.Router||{};bS=c.Route=c.Route||{};bT=c.Routing=c.Routing||{};bU=c.RouteMap=c.RouteMap||{};bV=c.Input=c.Input||{};bW=bV.MousePosSt=bV.MousePosSt||{};bX=bV.MouseBtnSt=bV.MouseBtnSt||{};bY=bV.Mouse=bV.Mouse||{};bZ=bV.KeyListenerSt=bV.KeyListenerSt||{};b0=bV.Keyboard=bV.Keyboard||{};b1=a.StartupCode$WebSharper_UI$Input=a.StartupCode$WebSharper_UI$Input||{};b2=b&&b.List;b3=b&&b.Arrays;b4=b&&b.Enumerator;b5=b&&b.Strings;b6=b&&b.Char;b7=b&&b.Collections;b8=b7&&b7.HashSet;b9=b&&b.Seq;b_=b&&b.Runtime;b$=b&&b.Unchecked;ca=a.console;cb=b&&b.Concurrency;cc=b7&&b7.Map;cd=b7&&b7.FSharpMap;ce=b&&b.Operators;cf=b&&b.Queue;cg=b&&b.Lazy;ch=b7&&b7.Dictionary;ci=a.JSON;cj=b&&b.Decimal;ck=b&&b.DateUtil;cl=b&&b.Numeric;cm=a.Node;cn=b&&b.Slice;co=b&&b.Sitelets;cp=co&&co.RouterModule;cq=co&&co.Route;cr=b&&b.Utils;cs=b&&b.Option;d.mapInPlace=function(ct,cu){var cv,cw;for(cv=0,cw=cu.length-1;cv<=cw;cv++)cu[cv]=ct(cu[cv]);return cu;};d.ofSeqNonCopying=function(ct){var cu,cv;if(ct instanceof a.Array)return ct;else if(ct instanceof b2.T)return b3.ofList(ct);else if(ct===null)return[];else{cu=[];cv=b4.Get(ct);try{while(cv.MoveNext())cu.push(cv.Current());return cu;}finally{if(typeof cv=="object"&&"Dispose"in cv)cv.Dispose();}}};d.MapTreeReduce=function(ct,cu,cv,cw){var cx;function cy(cz){return function(cA){var cB,cC;switch(cA<=0?0:cA===1?cz>=0&&cz<cx?1:(cB=cA,2):(cB=cA,2)){case 0:return cu;case 1:return ct(b3.get(cw,cz));case 2:cC=cA/2>>0;return cv((cy(cz))(cC),(cy(cz+cC))(cA-cC));}};}cx=b3.length(cw);return(cy(0))(cx);};d.TreeReduce=function(ct,cu,cv){var cw;function cx(cy){return function(cz){var cA,cB;switch(cz<=0?0:cz===1?cy>=0&&cy<cw?1:(cA=cz,2):(cA=cz,2)){case 0:return ct;case 1:return b3.get(cv,cy);case 2:cB=cz/2>>0;return cu((cx(cy))(cB),(cx(cy+cB))(cz-cB));}};}cw=b3.length(cv);return(cx(0))(cw);};e.isBlank=function(ct){return b5.forall(b6.IsWhiteSpace,ct);};f.maybeReplaceFirst=function(ct,cu,cv){var cw;cw=[false];return b2.map(function(cx){var cy;return!cw[0]&&ct(cx)?(cy=cu(cx),cy==null?cx:cy.$0):cx;},cv);};f.replaceFirst=function(ct,cu,cv){var cw;cw=[false];return b2.map(function(cx){return!cw[0]&&ct(cx)?cu(cx):cx;},cv);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){o.$cctor();return o.counter;};h.set_counter=function(ct){o.$cctor();o.counter=ct;};i.Filter=function(ct,cu){return new b8.New$2(b3.filter(ct,i.ToArray(cu)));};i.Intersect=function(ct,cu){var cv;cv=new b8.New$2(i.ToArray(ct));cv.IntersectWith(i.ToArray(cu));return cv;};i.Except=function(ct,cu){var cv;cv=new b8.New$2(i.ToArray(cu));cv.ExceptWith(i.ToArray(ct));return cv;};i.ToArray=function(ct){var cu;cu=b3.create(ct.Count(),void 0);ct.CopyTo(cu,0);return cu;};j.ToValueArray=function(ct){var cu;cu=b3.create(ct.count,void 0);b9.iteri(function(cv,cw){return b3.set(cu,cv,cw.V);},ct);return cu;};j.ToKeyArray=function(ct){var cu;cu=b3.create(ct.count,void 0);b9.iteri(function(cv,cw){return b3.set(cu,cv,cw.K);},ct);return cu;};l=g.Slot=b_.Class({GetHashCode:function(){return b$.Hash(this.key(this.value));},Equals:function(ct){return b$.Equals(this.key(this.value),this.key(ct.get_Value()));},get_Value:function(){return this.value;}},k,l);l.New=b_.Ctor(function(ct,cu){k.New.call(this);this.key=ct;this.value=cu;},l);l.Create=function(ct,cu){return new l.New(ct,cu);};m.OnError=function(ct){return ca.log("WebSharper UI: Uncaught asynchronous exception",ct);};m.StartTo=function(ct,cu){cb.StartWithContinuations(ct,cu,function(cv){m.OnError(cv);},a.ignore,null);};n.StartProcessor=function(ct){var cu;function cv(){var cw;cw=null;return cb.Delay(function(){return cb.Bind(ct,function(){var cx;cx=cu[0];return b$.Equals(cx,1)?(cu[0]=0,cb.Zero()):b$.Equals(cx,2)?(cu[0]=1,cv()):cb.Zero();});});}cu=[0];return function(){var cw;cw=cu[0];if(b$.Equals(cw,0)){cu[0]=1;cb.Start(cv(),null);}else b$.Equals(cw,1)?cu[0]=2:void 0;};};o.$cctor=function(){o.$cctor=a.ignore;o.counter=0;};p.FromArray=function(ct){var cu;cu=ct.length;return cu===0?{$:0}:cu===1?{$:1,$0:b3.get(ct,0)}:{$:3,$0:ct.slice()};};p.ToArray=function(ct){var cu;function cv(cw){var cx,cy;while(true)if(cw.$==1)return cu.push(cw.$0);else if(cw.$==2){cx=cw.$1;cy=cw.$0;cv(cy);cw=cx;}else return cw.$==3?b3.iter(function(cz){cu.push(cz);},cw.$0):null;}cu=[];cv(ct);return cu.slice(0);};p.Single=function(ct){return{$:1,$0:ct};};p.Concat=function(ct){var cu;cu=d.ofSeqNonCopying(ct);return d.TreeReduce(p.Empty(),p.Append,cu);};p.Append=function(ct,cu){return ct.$==0?cu:cu.$==0?ct:{$:2,$0:ct,$1:cu};};p.Empty=function(){q.$cctor();return q.Empty;};q.$cctor=function(){q.$cctor=a.ignore;q.Empty={$:0};};r.ParseHTMLIntoFakeRoot=function(ct){var cu,cv,cw,cx,cy;function cz(cA,cB){var cC;while(true)if(cB===0)return cA;else{cC=cB;cA=cA.lastChild;cB=cC-1;}}cu=self.document.createElement("div");return!r.rhtml().test(ct)?(cu.appendChild(self.document.createTextNode(ct)),cu):(cv=(cw=r.rtagName().exec(ct),b$.Equals(cw,null)?"":b3.get(cw,1).toLowerCase()),(cx=(cy=(r.wrapMap())[cv],cy?cy:r.defaultWrap()),(cu.innerHTML=cx[1]+ct.replace(r.rxhtmlTag(),"<$1></$2>")+cx[2],cz(cu,cx[0]))));};r.defaultWrap=function(){s.$cctor();return s.defaultWrap;};r.wrapMap=function(){s.$cctor();return s.wrapMap;};r.rhtml=function(){s.$cctor();return s.rhtml;};r.rtagName=function(){s.$cctor();return s.rtagName;};r.rxhtmlTag=function(){s.$cctor();return s.rxhtmlTag;};r.IterSelectorDoc=function(ct,cu){var cv,cw,cx;cv=self.document.querySelectorAll(ct);for(cw=0,cx=cv.length-1;cw<=cx;cw++)cu(cv[cw]);};r.IterSelector=function(ct,cu,cv){var cw,cx,cy;cw=ct.querySelectorAll(cu);for(cx=0,cy=cw.length-1;cx<=cy;cx++)cv(cw[cx]);};r.ChildrenArray=function(ct){var cu,cv,cw;cu=[];for(cv=0,cw=ct.childNodes.length-1;cv<=cw;cv++)cu.push(ct.childNodes[cv]);return cu;};r.RemoveClass=function(ct,cu){var cv;r.setClass(ct,(cv=r.clsRE(cu),r.getClass(ct).replace(cv,function(cw,cx,cy){return cx==""||cy==""?"":" ";})));};r.AddClass=function(ct,cu){var cv;cv=r.getClass(ct);if(cv=="")r.setClass(ct,cu);else!r.clsRE(cu).test(cv)?r.setClass(ct,cv+" "+cu):void 0;};r.setClass=function(ct,cu){if(ct instanceof a.SVGElement)ct.setAttribute("class",cu);else ct.className=cu;};r.getClass=function(ct){return ct instanceof a.SVGElement?ct.getAttribute("class"):ct.className;};r.clsRE=function(ct){return new a.RegExp("(\\s+|^)"+ct+"(?:\\s+"+ct+")*(\\s+|$)","g");};r.InsertAt=function(ct,cu,cv){var cw;if(!(cv.parentNode===ct&&cu===(cw=cv.nextSibling,b$.Equals(cw,null)?null:cw)))ct.insertBefore(cv,cu);};r.RemoveNode=function(ct,cu){if(cu.parentNode===ct)ct.removeChild(cu);};s.$cctor=function(){var ct;s.$cctor=a.ignore;s.rxhtmlTag=new a.RegExp("<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>","gi");s.rtagName=new a.RegExp("<([\\w:]+)");s.rhtml=new a.RegExp("<|&#?\\w+;");s.wrapMap=(ct=[1,"<table>","</table>"],{option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:ct,tbody:ct,tfoot:ct,tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><colgroup>","</colgoup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"]});s.defaultWrap=[0,"",""];};u.NotFound={$:1};t.Empty=function(){v.$cctor();return v.Empty;};t.Lookup=function(ct,cu){return t.Look(b2.ofSeq(cu),ct);};t.Look=function(ct,cu){var cv,cw;switch(cu.$==2?(cv=cu.$0,0):cu.$==0?ct.$==1?(cv=[ct.$0,ct.$1,cu.$0],1):2:2){case 0:return{$:0,$0:cv,$1:ct};case 1:cw=cv[2].TryFind(cv[0]);return cw==null?u.NotFound:t.Look(cv[1],cw.$0);case 2:return u.NotFound;}};t.ToArray=function(ct){var cu;cu=[];t.Map(function(){return function(cv){return cu.push(cv);};},ct);return cu.slice(0);};t.Mapi=function(ct,cu){var cv;function cw(){var cx;cx=cv[0];cv[0]=cx+1;return cx;}cv=[0];return t.Map(function(cx){return ct(cw(),cx);},cu);};t.Map=function(ct,cu){return t.MapLoop(b2.T.Empty,ct,cu);};t.MapLoop=function(ct,cu,cv){return cv.$==1?{$:1}:cv.$==2?{$:2,$0:(cu(ct))(cv.$0)}:t.TrieBranch(cc.Map(function(cw,cx){return t.MapLoop(b2.append(ct,b2.ofArray([cw])),cu,cx);},cv.$0));};t.Merge=function(ct){var cu,cv,cw;cu=d.ofSeqNonCopying(ct);cv=b3.length(cu);return cv===0?{$:1,$0:{$:1}}:cv===1?{$:1,$0:b3.get(cu,0)}:b3.exists(t.IsLeaf,cu)?null:(cw=t.MergeMaps(t.Merge,b9.choose(function(cx){return cx.$==0?{$:1,$0:cx.$0}:null;},cu)),cw==null?null:{$:1,$0:t.TrieBranch(cw.$0)});};t.IsLeaf=function(ct){return ct.$==2;};t.MergeMaps=function(ct,cu){var cv,cw;function cx(cy,cz){var cA;cA=ct(cz);return cA==null?null:{$:1,$0:[cy,cA.$0]};}cv=t.AllSome(b9.map(function(cy){return cx(cy[0],cy[1]);},cc.ToSeq((cw=b9.collect(cc.ToSeq,cu),b9.fold(function(cy,cz){return t.MultiAdd(cz[0],cz[1],cy);},new cd.New([]),cw)))));return cv==null?null:{$:1,$0:cc.OfArray(b3.ofSeq(cv.$0))};};t.AllSome=function(ct){var cu,cv,cw,cx;cv=b4.Get(ct);cw=b_.MarkResizable([]);cu=true;while(cu&&cv.MoveNext()){cx=cv.Current();if(cx!=null&&cx.$==1)cw.push(cx.$0);else cu=false;}return cu?{$:1,$0:cw.slice()}:null;};t.MultiAdd=function(ct,cu,cv){return cv.Add$1(ct,new b2.T({$:1,$0:cu,$1:t.MultiFind(ct,cv)}));};t.MultiFind=function(ct,cu){var cv;cv=cu.TryFind(ct);return cv==null?b2.T.Empty:cv.$0;};t.Prefix=function(ct,cu){return t.TrieBranch(new cd.New(b2.ofArray([[ct,cu]])));};t.Leaf=function(ct){return{$:2,$0:ct};};t.TrieBranch=function(ct){return ct.get_IsEmpty()?{$:1}:{$:0,$0:ct};};v.$cctor=function(){v.$cctor=a.ignore;v.Empty={$:1};};w.Obsolete=function(ct){var cu,cv,cw,cx,cy;cv=ct.s;if(cv==null||(cv!=null&&cv.$==2?(cu=cv.$1,false):cv!=null&&cv.$==3?(cu=cv.$1,false):true))void 0;else{ct.s=null;for(cw=0,cx=b3.length(cu)-1;cw<=cx;cw++){cy=b3.get(cu,cw);if(typeof cy=="object")(function(cz){w.Obsolete(cz);}(cy));else cy();}}};w.New=function(ct){return{s:ct};};w.MapAsync=function(ct,cu){var cv;cv=w.New({$:3,$0:[],$1:[]});w.When(cu,function(cw){m.StartTo(ct(cw),function(cx){w.MarkDone(cv,cu,cx);});},cv);return cv;};w.SnapshotOn=function(ct,cu){var cv;function cw(cx){var cy,cz,cA;if(!(cy=cv.s,cy!=null&&cy.$==0||cy!=null&&cy.$==2)){cz=w.ValueAndForever(ct);cA=w.ValueAndForever(cu);if(cz!=null&&cz.$==1)cA!=null&&cA.$==1?cz.$0[1]||cA.$0[1]?w.MarkForever(cv,cA.$0[0]):w.MarkReady(cv,cA.$0[0]):void 0;}}cv=w.New({$:3,$0:[],$1:[]});w.When(ct,cw,cv);w.WhenReady(cu,cw);return cv;};w.Map3=function(ct,cu,cv,cw){var cx,cy,cz,cA;function cB(cC){var cD,cE,cF,cG;if(!(cD=cA.s,cD!=null&&cD.$==0||cD!=null&&cD.$==2)){cE=w.ValueAndForever(cu);cF=w.ValueAndForever(cv);cG=w.ValueAndForever(cw);if(cE!=null&&cE.$==1)cF!=null&&cF.$==1?cG!=null&&cG.$==1?cE.$0[1]&&cF.$0[1]&&cG.$0[1]?w.MarkForever(cA,ct(cE.$0[0],cF.$0[0],cG.$0[0])):w.MarkReady(cA,ct(cE.$0[0],cF.$0[0],cG.$0[0])):void 0:void 0;}}cx=cu.s;cy=cv.s;cz=cw.s;return cx!=null&&cx.$==0?cy!=null&&cy.$==0?cz!=null&&cz.$==0?w.New({$:0,$0:ct(cx.$0,cy.$0,cz.$0)}):w.Map3Opt1(ct,cx.$0,cy.$0,cw):cz!=null&&cz.$==0?w.Map3Opt2(ct,cx.$0,cz.$0,cv):w.Map3Opt3(ct,cx.$0,cv,cw):cy!=null&&cy.$==0?cz!=null&&cz.$==0?w.Map3Opt4(ct,cy.$0,cz.$0,cu):w.Map3Opt5(ct,cy.$0,cu,cw):cz!=null&&cz.$==0?w.Map3Opt6(ct,cz.$0,cu,cv):(cA=w.New({$:3,$0:[],$1:[]}),(w.When(cu,cB,cA),w.When(cv,cB,cA),w.When(cw,cB,cA),cA));};w.Map3Opt6=function(ct,cu,cv,cw){return w.Map2(function(cx,cy){return ct(cx,cy,cu);},cv,cw);};w.Map3Opt5=function(ct,cu,cv,cw){return w.Map2(function(cx,cy){return ct(cx,cu,cy);},cv,cw);};w.Map3Opt4=function(ct,cu,cv,cw){return w.Map(function(cx){return ct(cx,cu,cv);},cw);};w.Map3Opt3=function(ct,cu,cv,cw){return w.Map2(function(cx,cy){return ct(cu,cx,cy);},cv,cw);};w.Map3Opt2=function(ct,cu,cv,cw){return w.Map(function(cx){return ct(cu,cx,cv);},cw);};w.Map3Opt1=function(ct,cu,cv,cw){return w.Map(function(cx){return ct(cu,cv,cx);},cw);};w.Map2Unit=function(ct,cu){var cv,cw,cx;function cy(){var cz,cA,cB;if(!(cz=cx.s,cz!=null&&cz.$==0||cz!=null&&cz.$==2)){cA=w.ValueAndForever(ct);cB=w.ValueAndForever(cu);if(cA!=null&&cA.$==1)cB!=null&&cB.$==1?cA.$0[1]&&cB.$0[1]?w.MarkForever(cx,null):w.MarkReady(cx,null):void 0;}}cv=ct.s;cw=cu.s;return cv!=null&&cv.$==0?cw!=null&&cw.$==0?w.New({$:0,$0:null}):cu:cw!=null&&cw.$==0?ct:(cx=w.New({$:3,$0:[],$1:[]}),(w.When(ct,cy,cx),w.When(cu,cy,cx),cx));};w.Map2=function(ct,cu,cv){var cw,cx,cy;function cz(cA){var cB,cC,cD;if(!(cB=cy.s,cB!=null&&cB.$==0||cB!=null&&cB.$==2)){cC=w.ValueAndForever(cu);cD=w.ValueAndForever(cv);if(cC!=null&&cC.$==1)cD!=null&&cD.$==1?cC.$0[1]&&cD.$0[1]?w.MarkForever(cy,ct(cC.$0[0],cD.$0[0])):w.MarkReady(cy,ct(cC.$0[0],cD.$0[0])):void 0;}}cw=cu.s;cx=cv.s;return cw!=null&&cw.$==0?cx!=null&&cx.$==0?w.New({$:0,$0:ct(cw.$0,cx.$0)}):w.Map2Opt1(ct,cw.$0,cv):cx!=null&&cx.$==0?w.Map2Opt2(ct,cx.$0,cu):(cy=w.New({$:3,$0:[],$1:[]}),(w.When(cu,cz,cy),w.When(cv,cz,cy),cy));};w.Map2Opt2=function(ct,cu,cv){return w.Map(function(cw){return ct(cw,cu);},cv);};w.Map2Opt1=function(ct,cu,cv){return w.Map(function(cw){return ct(cu,cw);},cv);};w.MapCachedBy=function(ct,cu,cv,cw){return w.Map(function(cx){var cy,cz,cA;cy=cu[0];return cy!=null&&cy.$==1&&(ct(cx,cy.$0[0])&&(cz=[cy.$0[0],cy.$0[1]],true))?cz[1]:(cA=cv(cx),(cu[0]={$:1,$0:[cx,cA]},cA));},cw);};w.Copy=function(ct){var cu,cv,cw;cu=ct.s;return cu==null?ct:cu!=null&&cu.$==2?(cv=w.New({$:2,$0:cu.$0,$1:[]}),(w.WhenObsolete(ct,cv),cv)):cu!=null&&cu.$==3?(cw=w.New({$:3,$0:[],$1:[]}),(w.When(ct,function(cx){w.MarkDone(cw,ct,cx);},cw),cw)):ct;};w.WithInitOption=function(ct){var cu,cv,cw;cu=ct.s;return cu==null?w.New(null):cu!=null&&cu.$==2?(cv=w.New({$:2,$0:{$:1,$0:cu.$0},$1:[]}),(w.WhenObsolete(ct,cv),cv)):cu!=null&&cu.$==3?(cw=w.New({$:2,$0:null,$1:[]}),(w.When(ct,function(){w.Obsolete(cw);},cw),cw)):w.New({$:0,$0:{$:1,$0:cu.$0}});};w.WithInit=function(ct,cu){var cv,cw,cx;cv=cu.s;return cv==null?cu:cv!=null&&cv.$==2?(cw=w.New({$:2,$0:cv.$0,$1:[]}),(w.WhenObsolete(cu,cw),cw)):cv!=null&&cv.$==3?(cx=w.New({$:2,$0:ct,$1:[]}),(w.When(cu,function(){w.Obsolete(cx);},cx),cx)):cu;};w.Map=function(ct,cu){var cv,cw;cv=cu.s;return cv!=null&&cv.$==0?w.New({$:0,$0:ct(cv.$0)}):(cw=w.New({$:3,$0:[],$1:[]}),(w.When(cu,function(cx){w.MarkDone(cw,cu,ct(cx));},cw),cw));};w.Sequence=function(ct){var cu,cv,cw;function cx(cy){var cz;if(cw[0]===0){cz=b3.map(function(cA){var cB;cB=cA.s;return cB!=null&&cB.$==0?cB.$0:cB!=null&&cB.$==2?cB.$0:ce.FailWith("value not found by View.Sequence");},cu);if(b3.forall(function(cA){var cB;cB=cA.s;return cB!=null&&cB.$==0;},cu))w.MarkForever(cv,cz);else w.MarkReady(cv,cz);}else cw[0]=cw[0]-1;}cu=b3.ofSeq(ct);return cu.length==0?w.New({$:0,$0:[]}):(cv=w.New({$:3,$0:[],$1:[]}),(cw=[b3.length(cu)-1],(b3.iter(function(cy){w.When(cy,cx,cv);},cu),cv)));};w.CreateForeverAsync=function(ct){var cu;cu=w.New({$:3,$0:[],$1:[]});m.StartTo(ct,function(cv){w.MarkForever(cu,cv);});return cu;};w.JoinInner=function(ct){var cu;cu=w.New({$:3,$0:[],$1:[]});w.When(ct,function(cv){var cw;cw=cv();w.When(cw,function(cx){var cy,cz;if((cy=cw.s,cy!=null&&cy.$==0)&&(cz=ct.s,cz!=null&&cz.$==0))w.MarkForever(cu,cx);else w.MarkReady(cu,cx);},cu);w.WhenObsolete(ct,cw);},cu);return cu;};w.Join=function(ct){var cu;cu=w.New({$:3,$0:[],$1:[]});w.When(ct,function(cv){var cw;cw=cv();w.When(cw,function(cx){var cy,cz;if((cy=cw.s,cy!=null&&cy.$==0)&&(cz=ct.s,cz!=null&&cz.$==0))w.MarkForever(cu,cx);else w.MarkReady(cu,cx);},cu);},cu);return cu;};w.ValueAndForever=function(ct){var cu;cu=ct.s;return cu!=null&&cu.$==0?{$:1,$0:[cu.$0,true]}:cu!=null&&cu.$==2?{$:1,$0:[cu.$0,false]}:null;};w.WhenObsoleteRun=function(ct,cu){var cv;cv=ct.s;if(cv==null)cu();else cv!=null&&cv.$==2?cv.$1.push(cu):cv!=null&&cv.$==3?cv.$1.push(cu):void 0;};w.WhenObsolete=function(ct,cu){var cv;cv=ct.s;if(cv==null)w.Obsolete(cu);else cv!=null&&cv.$==2?w.EnqueueSafe(cv.$1,cu):cv!=null&&cv.$==3?w.EnqueueSafe(cv.$1,cu):void 0;};w.WhenReady=function(ct,cu){var cv,cw;cw=ct.s;switch(cw!=null&&cw.$==2?(cv=cw.$0,0):cw==null?1:cw!=null&&cw.$==3?2:(cv=cw.$0,0)){case 0:cu(cv);break;case 1:null;break;case 2:cw.$0.push(cu);break;}};w.WhenRun=function(ct,cu,cv){var cw;cw=ct.s;if(cw==null)cv();else cw!=null&&cw.$==2?(cw.$1.push(cv),cu(cw.$0)):cw!=null&&cw.$==3?(cw.$0.push(cu),cw.$1.push(cv)):cu(cw.$0);};w.When=function(ct,cu,cv){var cw;cw=ct.s;if(cw==null)w.Obsolete(cv);else cw!=null&&cw.$==2?(w.EnqueueSafe(cw.$1,cv),cu(cw.$0)):cw!=null&&cw.$==3?(cw.$0.push(cu),w.EnqueueSafe(cw.$1,cv)):cu(cw.$0);};w.EnqueueSafe=function(ct,cu){var cv,cw,cx,cy;ct.push(cu);if(ct.length%20===0){cv=ct.slice(0);cf.Clear(ct);for(cw=0,cx=b3.length(cv)-1;cw<=cx;cw++){cy=b3.get(cv,cw);if(typeof cy=="object")(function(cz){if(cz.s)ct.push(cz);}(cy));else(function(cz){ct.push(cz);}(cy));}}else void 0;};w.MarkDone=function(ct,cu,cv){var cw;if(cw=cu.s,cw!=null&&cw.$==0)w.MarkForever(ct,cv);else w.MarkReady(ct,cv);};w.MarkReady=function(ct,cu){var cv,cw,cx,cy;cv=ct.s;if(cv!=null&&cv.$==3){ct.s={$:2,$0:cu,$1:cv.$1};cw=cv.$0;for(cx=0,cy=b3.length(cw)-1;cx<=cy;cx++)(b3.get(cw,cx))(cu);}else void 0;};w.MarkForever=function(ct,cu){var cv,cw,cx,cy;cv=ct.s;if(cv!=null&&cv.$==3){ct.s={$:0,$0:cu};cw=cv.$0;for(cx=0,cy=b3.length(cw)-1;cx<=cy;cx++)(b3.get(cw,cx))(cu);}else void 0;};w.TryGet=function(ct){var cu,cv;cu=ct.s;return(cu!=null&&cu.$==0?(cv=cu.$0,true):cu!=null&&cu.$==2&&(cv=cu.$0,true))?{$:1,$0:cv}:null;};x=c.Var=b_.Class({},k,x);x.New=b_.Ctor(function(){k.New.call(this);},x);y=c.View=b_.Class({get_V:function(){return ce.FailWith("View<'T>.V can only be called in an argument to a V-enabled function or if 'T = Doc.");}},null,y);z=c.ConcreteVar=b_.Class({get_Id:function(){return"uinref"+a.String(this.id);},get_View:function(){return this.view;},UpdateMaybe:function(ct){var cu;cu=ct(this.Get());if(cu!=null&&cu.$==1)this.Set(cu.$0);},Update:function(ct){this.Set(ct(this.Get()));},SetFinal:function(ct){if(this.isConst)(function(cu){return cu("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(cu){ca.log(cu);}));else{w.Obsolete(this.snap);this.isConst=true;this.current=ct;this.snap=w.New({$:0,$0:ct});}},Set:function(ct){if(this.isConst)(function(cu){return cu("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(cu){ca.log(cu);}));else{w.Obsolete(this.snap);this.current=ct;this.snap=w.New({$:2,$0:ct,$1:[]});}},Get:function(){return this.current;}},x,z);z.New=b_.Ctor(function(ct,cu,cv){var cw;cw=this;x.New.call(this);this.isConst=ct;this.current=cv;this.snap=cu;this.view=function(){return cw.snap;};this.id=h.Int();},z);A=c.Var$1=b_.Class({},k,A);A.MapLens=function(ct,cu,cv){return y.MapSeqCachedViewBy(ct,function(cw,cx){var cy,cz;function cA(cB){return b$.Equals(ct(cB),cw);}cy=h.Id();return cu((cz=new x({Get:function(){return b9.find(cA,cv.Get());},Set:function(cB){function cC(cD){return cB;}return cv.Update(function(cD){return f.replaceFirst(cA,cC,cD);});},SetFinal:function(cB){return this.Set(cB);},Update:function(cB){return cv.Update(function(cC){return f.replaceFirst(cA,cB,cC);});},UpdateMaybe:function(cB){return cv.Update(function(cC){return f.maybeReplaceFirst(cA,cB,cC);});},get_View:function(){return cx;},get_Id:function(){return cy;}}),(x.New.call(cz),cz)));},cv.get_View());};A.Lens=function(ct,cu,cv){var cw,cx,cy;cw=h.Id();cx=y.Map(cu,ct.get_View());cy=new x({Get:function(){return cu(ct.Get());},Set:function(cz){return ct.Update(function(cA){return cv(cA,cz);});},SetFinal:function(cz){return this.Set(cz);},Update:function(cz){return ct.Update(function(cA){return cv(cA,cz(cu(cA)));});},UpdateMaybe:function(cz){return ct.UpdateMaybe(function(cA){var cB;cB=cz(cu(cA));return cB==null?null:{$:1,$0:cv(cA,cB.$0)};});},get_View:function(){return cx;},get_Id:function(){return cw;}});x.New.call(cy);return cy;};A.Update=function(ct,cu){A.Set(ct,cu(ct.Get()));};A.SetFinal=function(ct,cu){ct.SetFinal(cu);};A.Set=function(ct,cu){ct.Set(cu);};A.CreateWaiting=function(){return new z.New(false,w.New({$:3,$0:[],$1:[]}),null);};A.Create=function(){return new z.New(false,w.New({$:2,$0:null,$1:[]}),null);};A.CreateLogged=function(ct,cu){var cv;if(!self.UINVars)self.UINVars=[];cv=A.Create$1(cu);self.UINVars.push([ct,cv]);return cv;};A.Create$1=function(ct){return new z.New(false,w.New({$:2,$0:ct,$1:[]}),ct);};A.New=b_.Ctor(function(){k.New.call(this);},A);B=c.Updates=b_.Class({set_Value:function(ct){var cu;cu=this.s;if(!(cu===null))w.Obsolete(cu);this.c=ct;}},null,B);B.Create=function(ct){var cu;cu=null;cu=B.New(ct,null,function(){var cv;cv=cu.s;return cv===null?(cv=w.Copy(cu.c()),cu.s=cv,w.WhenObsoleteRun(cv,function(){cu.s=null;}),cv):cv;});return cu;};B.New=function(ct,cu,cv){return new B({c:ct,s:cu,v:cv});};y.get_Do=function(){return D.B;};y.Apply=function(ct,cu){return y.Map2(function(cv,cw){return cv(cw);},ct,cu);};y.AsyncAwait=function(ct,cu){function cv(cw){var cx,cy;function cz(){return y.RemovableSink(function(cA){if(ct(cA)){(cg.Force(cx))();cw(cA);}},cu);}cx=cg.Create(cz);cy=cg.Force(cx);}return cb.FromContinuations(function(cw,cx,cy){return cv.apply(null,[cw,cx,cy]);});};y.RemovableSink=function(ct,cu){var cv;function cw(){w.WhenRun(cu(),function(cx){if(cv[0])ct(cx);},function(){if(cv[0])cb.scheduler().Fork(cw);});}cv=[true];cb.scheduler().Fork(cw);return function(){cv[0]=false;};};y.Sink=function(ct,cu){function cv(){w.WhenRun(cu(),ct,function(){cb.scheduler().Fork(cv);});}cb.scheduler().Fork(cv);};y.TryFinally=function(ct,cu){return y.CreateLazy(function(){try{return cu();}finally{ct();}});};y.TryWith=function(ct,cu){return y.CreateLazy(function(){try{return cu();}catch(cv){return(ct(cv))();}});};y.ConstAsync=function(ct){var cu;cu=w.CreateForeverAsync(ct);return function(){return cu;};};y.Const=function(ct){var cu;cu=w.New({$:0,$0:ct});return function(){return cu;};};y.Sequence=function(ct){return y.CreateLazy(function(){return w.Sequence(b9.map(function(cu){return cu();},ct));});};y.UpdateWhile=function(ct,cu,cv){var cw;cw=[ct];return y.BindInner(function(cx){return cx?y.Map(function(cy){cw[0]=cy;return cy;},cv):y.Const(cw[0]);},cu);};y.BindInner=function(ct,cu){return y.JoinInner(y.Map(ct,cu));};y.JoinInner=function(ct){return y.CreateLazy(function(){return w.JoinInner(ct());});};y.Bind=function(ct,cu){return y.Join(y.Map(ct,cu));};y.Join=function(ct){return y.CreateLazy(function(){return w.Join(ct());});};y.MapSeqCachedView=function(ct,cu){function cv(cw){return ct;}return y.MapSeqCachedViewBy(a.id,function(cw,cx){return(cv(cw))(cx);},cu);};y.MapSeqCachedViewBy=function(ct,cu,cv){var cw;cw=[new ch.New$5()];return y.Map(function(cx){var cy,cz,cA;cy=cw[0];cz=new ch.New$5();cA=d.mapInPlace(function(cB){var cC,cD,cE;cC=ct(cB);cD=cy.ContainsKey(cC)?(cE=cy.Item(cC),(A.Set(cE.r,cB),cE)):y.ConvertSeqNode(function(cF){return cu(cC,cF);},cB);cz.set_Item(cC,cD);return cD.e;},b3.ofSeq(cx));cw[0]=cz;return cA;},cv);};y.ConvertSeqNode=function(ct,cu){var cv,cw;cv=A.Create$1(cu);cw=cv.get_View();return{e:ct(cw),r:cv,w:cw};};y.MapSeqCached=function(ct,cu){return y.MapSeqCachedBy(a.id,ct,cu);};y.MapSeqCachedBy=function(ct,cu,cv){var cw;cw=[new ch.New$5()];return y.Map(function(cx){var cy,cz,cA;cy=cw[0];cz=new ch.New$5();cA=d.mapInPlace(function(cB){var cC,cD;cC=ct(cB);cD=cy.ContainsKey(cC)?cy.Item(cC):cu(cB);cz.set_Item(cC,cD);return cD;},b3.ofSeq(cx));cw[0]=cz;return cA;},cv);};y.SnapshotOn=function(ct,cu,cv){var cw;cw=w.New({$:2,$0:ct,$1:[]});return y.CreateLazy(function(){return cw.s==null?w.SnapshotOn(cu(),cv()):(w.WhenObsolete(cu(),cw),cw);});};y.GetAsync=function(ct){return cb.FromContinuations(function(cu){return y.Get(cu,ct);});};y.WithInitOption=function(ct){return y.CreateLazy(function(){return w.WithInitOption(ct());});};y.WithInit=function(ct,cu){return y.CreateLazy(function(){return w.WithInit(ct,cu());});};y.Get=function(ct,cu){var cv;function cw(){w.WhenRun(cu(),function(cx){if(!cv[0]){cv[0]=true;ct(cx);}},function(){if(!cv[0])cw();});}cv=[false];cw();};y.TryGet=function(ct){return w.TryGet(ct());};y.MapAsync2=function(ct,cu,cv){return y.MapAsync(a.id,y.Map2(ct,cu,cv));};y.MapAsync=function(ct,cu){return y.CreateLazy(function(){return w.MapAsync(ct,cu());});};y.Map3=function(ct,cu,cv,cw){return y.CreateLazy(function(){return w.Map3(ct,cu(),cv(),cw());});};y.Map2Unit=function(ct,cu){return y.CreateLazy(function(){return w.Map2Unit(ct(),cu());});};y.Map2=function(ct,cu,cv){return y.CreateLazy(function(){return w.Map2(ct,cu(),cv());});};y.MapCached=function(ct,cu){return y.MapCachedBy(b$.Equals,ct,cu);};y.MapCachedBy=function(ct,cu,cv){var cw;cw=[null];return y.CreateLazy(function(){return w.MapCachedBy(ct,cw,cu,cv());});};y.Map=function(ct,cu){return y.CreateLazy(function(){return w.Map(ct,cu());});};y.CreateLazy=function(ct){var cu;cu={c:null,o:ct};return function(){var cv,cw;cv=cu.c;return cv===null?(cv=cu.o(),cu.c=cv,(cw=cv.s,cw!=null&&cw.$==0)?cu.o=null:w.WhenObsoleteRun(cv,function(){cu.c=null;}),cv):cv;};};C=c.FromView=b_.Class({get_Id:function(){return"uinref"+a.String(this.id);},SetFinal:function(ct){this.set(ct);},Update:function(ct){var cu;y.Get((cu=this.set,function(cv){return cu(ct(cv));}),this.view);},UpdateMaybe:function(ct){var cu;cu=this;y.Get(function(cv){var cw;cw=ct(cv);if(cw!=null&&cw.$==1)cu.set(cw.$0);},this.view);},Set:function(ct){this.set(ct);},Get:function(){return this.current;},get_View:function(){return this.view;}},x,C);C.New=b_.Ctor(function(ct,cu){var cv,cw;cv=this;x.New.call(this);this.set=cu;this.id=h.Int();this.current=(cw=y.TryGet(ct),cw==null?null:cw.$0);this.view=y.Map(function(cx){cv.current=cx;return cx;},ct);},C);D.B={$:0};E=c.Submitter=b_.Class({Trigger:function(){this["var"].Set(null);}},k,E);E.New=b_.Ctor(function(ct,cu){k.New.call(this);this.input=ct;this["var"]=A.Create();this.view=y.SnapshotOn(cu,this["var"].get_View(),this.input);},E);E.CreateOption=function(ct){return new E.New(y.Map(function(cu){return{$:1,$0:cu};},ct),null);};F.Fresh=function(){return{$:0,$0:h.Int()};};G=c.Model=b_.Class({},k,G);G.New=b_.Ctor(function(ct,cu){var cv;cv=A.Create$1(cu);G.New$1.call(this,cv,y.Map(ct,cv.get_View()));},G);G.New$1=b_.Ctor(function(ct,cu){k.New.call(this);this["var"]=ct;this.view=cu;},G);G.Update=function(ct,cu){A.Update(cu["var"],function(cv){ct(cv);return cv;});};G.Create=function(ct,cu){return new G.New(ct,cu);};H.Default=function(){N.$cctor();return N.Default;};J=I.ArrayStorage=b_.Class({SSet:function(ct){return b3.ofSeq(ct);},SSetAt:function(ct,cu,cv){b3.set(cv,ct,cu);return cv;},SRemoveIf:function(ct,cu){return b3.filter(function(cv){return!ct(cv);},cu);},SInit:function(){return this.init;},SPrependMany:function(ct,cu){var cv;cv=d.ofSeqNonCopying(ct);cu.unshift.apply(cu,cv);return cu;},SPrepend:function(ct,cu){cu.unshift(ct);return cu;},SAppendMany:function(ct,cu){var cv;cv=d.ofSeqNonCopying(ct);cu.push.apply(cu,cv);return cu;},SAppend:function(ct,cu){cu.push(ct);return cu;}},k,J);J.New=b_.Ctor(function(ct){k.New.call(this);this.init=ct;},J);K=I.LocalStorageBackend=b_.Class({clear:function(){this.storage.removeItem(this.id);},set:function(ct){this.storage.setItem(this.id,ci.stringify(b3.map(this.serializer.Encode,ct)));return ct;},SSet:function(ct){return this.set(b3.ofSeq(ct));},SSetAt:function(ct,cu,cv){b3.set(cv,ct,cu);return this.set(cv);},SRemoveIf:function(ct,cu){return this.set(b3.filter(function(cv){return!ct(cv);},cu));},SInit:function(){var ct;ct=this.storage.getItem(this.id);if(ct==null)return[];else try{return b3.map(this.serializer.Decode,ci.parse(ct));}catch(cu){return[];}},SPrependMany:function(ct,cu){var cv;cv=d.ofSeqNonCopying(ct);cu.unshift.apply(cu,cv);return this.set(cu);},SPrepend:function(ct,cu){cu.unshift(ct);return this.set(cu);},SAppendMany:function(ct,cu){var cv;cv=d.ofSeqNonCopying(ct);cu.push.apply(cu,cv);return this.set(cu);},SAppend:function(ct,cu){cu.push(ct);return this.set(cu);}},k,K);K.New=b_.Ctor(function(ct,cu){k.New.call(this);this.id=ct;this.serializer=cu;this.storage=self.localStorage;},K);I.LocalStorage=function(ct,cu){return new K.New(ct,cu);};I.InMemory=function(ct){return new J.New(ct);};L=c.ListModel=b_.Class({Wrap:function(ct,cu,cv){return L.Wrap(this,ct,cu,cv);},MapLens:function(ct){var cu;cu=this;return y.MapSeqCachedViewBy(cu.key,function(cv,cw){return ct(cv,cu["LensInto'"](a.id,function(cx,cy){return cy;},cv,cw));},this["var"].get_View());},Lens:function(ct){return this.LensInto(a.id,function(cu,cv){return cv;},ct);},LensInto:function(ct,cu,cv){return this["LensInto'"](ct,cu,cv,y.Map(ct,this.FindByKeyAsView(cv)));},"LensInto'":function(ct,cu,cv,cw){var cx,cy,cz;cx=this;cy=h.Id();cz=new x({Get:function(){return ct(cx.FindByKey(cv));},Set:function(cA){return cx.UpdateBy(function(cB){return{$:1,$0:cu(cB,cA)};},cv);},SetFinal:function(cA){return this.Set(cA);},Update:function(cA){return cx.UpdateBy(function(cB){return{$:1,$0:cu(cB,cA(ct(cB)))};},cv);},UpdateMaybe:function(cA){return cx.UpdateBy(function(cB){var cC;cC=cA(ct(cB));return cC==null?null:{$:1,$0:cu(cB,cC.$0)};},cv);},get_View:function(){return cw;},get_Id:function(){return cy;}});x.New.call(cz);return cz;},get_LengthAsView:function(){return y.Map(b3.length,this["var"].get_View());},get_Length:function(){return b3.length(this["var"].Get());},Clear:function(){this["var"].Set(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(ct,cu){var cv,cw,cx,cy,cz;cv=this;cw=this["var"].Get();cx=b3.tryFindIndex(function(cA){return b$.Equals(cv.key(cA),cu);},cw);if(cx!=null&&cx.$==1){cy=cx.$0;cz=ct(b3.get(cw,cy));cz!=null&&cz.$==1?(this["var"].Set(this.storage.SSetAt(cy,cz.$0,cw)),this.ObsoleteKey(cu)):void 0;}},UpdateAll:function(ct){var cu;cu=this;this["var"].Update(function(cv){b3.iteri(function(cw,cx){var cy;cy=ct(cx);return cy==null?null:b3.set(cv,cw,cy.$0);},cv);return cu.storage.SSet(cv);});this.ObsoleteAll();},FindByKeyAsView:function(ct){return y.Map(function(cu){return cu.$0;},this.TryFindByKeyAsView(ct));},TryFindByKeyAsView:function(ct){var cu;cu=this;return function(){var cv,cw,cx;cv=(cw=null,[cu.it.TryGetValue(ct,{get:function(){return cw;},set:function(cy){cw=cy;}}),cw]);return cv[0]?cv[1]:(cx=w.New({$:2,$0:cu.TryFindByKey(ct),$1:[]}),(cu.it.DAdd(ct,cx),cx));};},TryFindByKey:function(ct){var cu;cu=this;return b3.tryFind(function(cv){return b$.Equals(cu.key(cv),ct);},this["var"].Get());},FindByKey:function(ct){var cu;cu=this;return b3.find(function(cv){return b$.Equals(cu.key(cv),ct);},this["var"].Get());},TryFindAsView:function(ct){return y.Map(function(cu){return b3.tryFind(ct,cu);},this["var"].get_View());},FindAsView:function(ct){return y.Map(function(cu){return b3.find(ct,cu);},this["var"].get_View());},TryFind:function(ct){return b3.tryFind(ct,this["var"].Get());},Find:function(ct){return b3.find(ct,this["var"].Get());},ContainsKeyAsView:function(ct){var cu;function cv(cw){return b$.Equals(cu.key(cw),ct);}cu=this;return y.Map(function(cw){return b3.exists(cv,cw);},this["var"].get_View());},ContainsKey:function(ct){var cu;cu=this;return b3.exists(function(cv){return b$.Equals(cu.key(cv),ct);},this["var"].Get());},Set:function(ct){this["var"].Set(this.storage.SSet(ct));this.ObsoleteAll();},Iter:function(ct){b3.iter(ct,this["var"].Get());},RemoveByKey:function(ct){var cu;cu=this;this["var"].Set(this.storage.SRemoveIf(function(cv){return b$.Equals(cu.key(cv),ct);},this["var"].Get()));this.ObsoleteKey(ct);},RemoveBy:function(ct){var cu,cv,cw,cx;cu=this["var"].Get();for(cv=0,cw=cu.length-1;cv<=cw;cv++){cx=b3.get(cu,cv);if(ct(cx))this.ObsoleteKey(this.key(cx));}this["var"].Set(this.storage.SRemoveIf(ct,this["var"].Get()));},Remove:function(ct){var cu,cv,cw,cx;cu=this;cv=this["var"].Get();if(M.Contains(cu.key,ct,cv)){cw=cu.key;cx=cw(ct);this["var"].Set(this.storage.SRemoveIf(function(cy){return b$.Equals(cw(cy),cx);},cv));this.ObsoleteKey(cx);}},PrependMany:function(ct){var cu,cv;function cw(cx,cy){var cz,cA;cz=cu.key(cy);cu.ObsoleteKey(cz);cA=b3.tryFindIndex(function(cB){return b$.Equals(cu.key(cB),cz);},cx);return cA==null?(cv.push(cy),cx):cu.storage.SSetAt(cA.$0,cy,cx);}cu=this;cv=b_.MarkResizable([]);this["var"].Set(this.storage.SPrependMany(cv,(((b_.Curried3(b9.fold))(cw))(this["var"].Get()))(ct)));},Prepend:function(ct){var cu,cv,cw,cx;cu=this;cv=this["var"].Get();cw=this.key(ct);cx=b3.tryFindIndex(function(cy){return b$.Equals(cu.key(cy),cw);},cv);if(cx!=null&&cx.$==1)this["var"].Set(this.storage.SSetAt(cx.$0,ct,cv));else this["var"].Set(this.storage.SPrepend(ct,cv));this.ObsoleteKey(cw);},AppendMany:function(ct){var cu,cv;function cw(cx,cy){var cz,cA;cz=cu.key(cy);cu.ObsoleteKey(cz);cA=b3.tryFindIndex(function(cB){return b$.Equals(cu.key(cB),cz);},cx);return cA==null?(cv.push(cy),cx):cu.storage.SSetAt(cA.$0,cy,cx);}cu=this;cv=b_.MarkResizable([]);this["var"].Set(this.storage.SAppendMany(cv,(((b_.Curried3(b9.fold))(cw))(this["var"].Get()))(ct)));},Append:function(ct){var cu,cv,cw,cx;cu=this;cv=this["var"].Get();cw=this.key(ct);cx=b3.tryFindIndex(function(cy){return b$.Equals(cu.key(cy),cw);},cv);if(cx!=null&&cx.$==1)this["var"].Set(this.storage.SSetAt(cx.$0,ct,cv));else this["var"].Set(this.storage.SAppend(ct,cv));this.ObsoleteKey(cw);},ObsoleteAll:function(){b9.iter(function(ct){w.Obsolete(ct.V);},this.it);this.it.Clear();},ObsoleteKey:function(ct){var cu,cv;cu=(cv=null,[this.it.TryGetValue(ct,{get:function(){return cv;},set:function(cw){cv=cw;}}),cv]);if(cu[0]){w.Obsolete(cu[1]);this.it.RemoveKey(ct);}},GetEnumerator0:function(){return b4.Get0(this["var"].Get());},GetEnumerator:function(){return b4.Get(this["var"].Get());}},k,L);L.New=b_.Ctor(function(ct,cu){L.New$3.call(this,ct,A.Create$1(b3.ofSeq(b9.distinctBy(ct,cu.SInit()))),cu);},L);L.New$1=b_.Ctor(function(ct){L.New$2.call(this,ct,[]);},L);L.New$2=b_.Ctor(function(ct,cu){var cv;cv=b3.ofSeq(cu);L.New$3.call(this,ct,A.Create$1(cv),I.InMemory(cv));},L);L.New$3=b_.Ctor(function(ct,cu,cv){k.New.call(this);this.key=ct;this["var"]=cu;this.storage=cv;this.v=y.Map(function(cw){return cw.slice();},this["var"].get_View());this.it=new ch.New$5();},L);M.Contains=function(ct,cu,cv){var cw;cw=ct(cu);return b3.exists(function(cx){return b$.Equals(ct(cx),cw);},cv);};L.Wrap=function(ct,cu,cv,cw){var cx,cy;cx=[new ch.New$5()];cy=b3.map(function(cz){var cA;cA=cv(cz);cx[0].set_Item(ct.key(cz),cA);return cA;},ct["var"].Get());return new L.New$3(function(cz){return ct.key(cu(cz));},A.Lens(ct["var"],function(cz){var cA,cB;cA=new ch.New$5();cB=b3.map(function(cC){var cD,cE;cD=ct.key(cC);cE=cx[0].ContainsKey(cD)?cw(cx[0].Item(cD),cC):cv(cC);cA.set_Item(cD,cE);return cE;},cz);cx[0]=cA;return cB;},function(cz,cA){var cB,cC;cB=new ch.New$5();cC=b3.map(function(cD){var cE;cE=cu(cD);cB.set_Item(ct.key(cE),cD);return cE;},cA);cx[0]=cB;return cC;}),I.InMemory(cy));};L.FromSeq=function(ct){return L.Create(a.id,ct);};L.Create=function(ct,cu){return L.CreateWithStorage(ct,I.InMemory(b3.ofSeq(cu)));};L.CreateWithStorage=function(ct,cu){return new L.New(ct,cu);};N.$cctor=function(){N.$cctor=a.ignore;N.Default={Encode:a.id,Decode:a.id};};O=c.ReactiveExtensions=b_.Class({},k,O);O.New=b_.Ctor(function(){k.New.call(this);},O);P=c.DoubleInterpolation=b_.Class({Interpolate:function(ct,cu,cv){return cu+ct*(cv-cu);}},null,P);P.DoubleInterpolation=new P({$:0});Q.get_Double=function(){return P.DoubleInterpolation;};R=c.Easing=b_.Class({TransformTime:function(ct){return this.transformTime(ct);}},k,R);R.get_CubicInOut=function(){return S.CubicInOut();};R.Custom=function(ct){return new R.New(ct);};R.New=b_.Ctor(function(ct){k.New.call(this);this.transformTime=ct;},R);S.CubicInOut=function(){W.$cctor();return W.CubicInOut;};T.get_Empty=function(){return{$:0,$0:p.Empty()};};T.WhenDone=function(ct,cu){return T.Append({$:0,$0:p.Single({$:0,$0:ct})},cu);};T.Run=function(ct,cu){var cv;function cw(cx){function cy(cz){return function(cA){var cB;cB=cA-cz;cu.Compute(cB);ct();return cB<=cv?void a.requestAnimationFrame(function(cC){(cy(cz))(cC);}):cx();};}a.requestAnimationFrame(function(cz){(cy(cz))(cz);});}cv=cu.Duration;return cv===0?cb.Zero():cb.FromContinuations(function(cx,cy,cz){return cw.apply(null,[cx,cy,cz]);});};T.Play=function(ct){var cu;cu=null;return cb.Delay(function(){return cb.Bind(T.Run(a.ignore,U.Actions(ct)),function(){U.Finalize(ct);return cb.Return(null);});});};T.Pack=function(ct){return{$:0,$0:p.Single({$:1,$0:ct})};};T.Map=function(ct,cu){var cv;return U.Def(cu.Duration,(cv=cu.Compute,function(cw){return ct(cv(cw));}));};T.Delayed=function(ct,cu,cv,cw,cx,cy){return{Compute:function(cz){return cz<=cw?cx:ct.Interpolate(cu.TransformTime((cz-cw)/cv),cx,cy);},Duration:cv+cw};};T.Simple=function(ct,cu,cv,cw,cx){return{Compute:function(cy){return ct.Interpolate(cu.TransformTime(cy/cv),cw,cx);},Duration:cv};};T.Const=function(ct){return U.Const(ct);};T.Concat=function(ct){return{$:0,$0:p.Concat(b9.map(U.List,ct))};};T.Append=function(ct,cu){return{$:0,$0:p.Append(ct.$0,cu.$0)};};T.set_UseAnimations=function(ct){U.set_UseAnimations(ct);};T.get_UseAnimations=function(){return U.UseAnimations();};U.UseAnimations=function(){W.$cctor();return W.UseAnimations;};U.set_UseAnimations=function(ct){W.$cctor();W.UseAnimations=ct;};U.Actions=function(ct){return U.ConcatActions(b3.choose(function(cu){return cu.$==1?{$:1,$0:cu.$0}:null;},p.ToArray(ct.$0)));};U.ConcatActions=function(ct){var cu,cv,cw,cx;cu=d.ofSeqNonCopying(ct);cv=b3.length(cu);return cv===0?U.Const():cv===1?b3.get(cu,0):(cw=b9.max(b9.map(function(cy){return cy.Duration;},cu)),(cx=b3.map(function(cy){return U.Prolong(cw,cy);},cu),U.Def(cw,function(cy){b3.iter(function(cz){cz.Compute(cy);},cx);})));};U.Prolong=function(ct,cu){var cv,cw,cx;cv=cu.Compute;cw=cu.Duration;cx=cg.Create(function(){return cu.Compute(cu.Duration);});return{Compute:function(cy){return cy>=cw?cx.f():cv(cy);},Duration:ct};};U.Const=function(ct){return U.Def(0,function(){return ct;});};U.Def=function(ct,cu){return{Compute:cu,Duration:ct};};U.Finalize=function(ct){b3.iter(function(cu){if(cu.$==0)cu.$0();},p.ToArray(ct.$0));};U.List=function(ct){return ct.$0;};V=c.Trans=b_.Class({Copy:function(ct,cu,cv,cw){var cx,cy,cz,cA,cB;function cC(cD,cE){return cx.TChange(cD,cE);}cx=this;cy=ct==null?function(cD){return function(cE){return cC(cD,cE);};}:ct.$0;return new V.New$3(function(cD,cE){return(cy(cD))(cE);},(cz=this.get_TEnter(),cu==null?cz:cu.$0),(cA=this.get_TExit(),cv==null?cA:cv.$0),(cB=this.get_TFlags(),cw==null?cB:cw.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(ct,cu){return this.change(ct,cu);}},k,V);V.New=b_.Ctor(function(ct,cu,cv){V.New$3.call(this,ct,b$.Equals(cu,null)?T.Const:cu,b$.Equals(cv,null)?T.Const:cv,1|(b$.Equals(cu,null)?0:2)|(b$.Equals(cv,null)?0:4));},V);V.New$1=b_.Ctor(function(ct){V.New$3.call(this,ct,T.Const,T.Const,1);},V);V.New$2=b_.Ctor(function(){V.New$3.call(this,function(ct,cu){return T.Const(cu);},T.Const,T.Const,0);},V);V.New$3=b_.Ctor(function(ct,cu,cv,cw){k.New.call(this);this.change=ct;this.enter=cu;this.exit=cv;this.flags=cw;},V);V.Exit=function(ct,cu){return cu.Copy(null,null,{$:1,$0:ct},{$:1,$0:cu.get_TFlags()|4});};V.Enter=function(ct,cu){return cu.Copy(null,{$:1,$0:ct},null,{$:1,$0:cu.get_TFlags()|2});};V.Change=function(ct,cu){return cu.Copy({$:1,$0:ct},null,null,{$:1,$0:cu.get_TFlags()|1});};V.Create=function(ct){return new V.New$1(ct);};V.Trivial=function(){return new V.New$2();};V.CanAnimateExit=function(ct){var cu,cv;cu=ct.get_TFlags();cv=4;return(cu&cv)===cv;};V.CanAnimateEnter=function(ct){var cu,cv;cu=ct.get_TFlags();cv=2;return(cu&cv)===cv;};V.CanAnimateChange=function(ct){var cu,cv;cu=ct.get_TFlags();cv=1;return(cu&cv)===cv;};V.AnimateExit=function(ct,cu){return(ct.get_TExit())(cu);};V.AnimateEnter=function(ct,cu){return(ct.get_TEnter())(cu);};V.AnimateChange=function(ct,cu,cv){return ct.TChange(cu,cv);};W.$cctor=function(){W.$cctor=a.ignore;W.CubicInOut=R.Custom(function(ct){var cu;cu=ct*ct;return 3*cu-2*(cu*ct);});W.UseAnimations=true;};Z=c.OnAfterRenderControl=b_.Class({get_Body:function(){var ct,cu,cv,cw,cx,cy,cz;cu=self.document.querySelectorAll("[ws-runafterrender]");for(cv=0,cw=cu.length-1;cv<=cw;cv++){cx=cu[cv];cy=cx.getAttribute("ws-runafterrender");if(cy.indexOf("AfterRenderQ2Client")!=-1){cx.removeAttribute("ws-runafterrender");a["eval"](cy);}else{cz=a["eval"](cy);cx.removeAttribute("ws-runafterrender");cz(cx);}}ct={ReplaceInDom:function(){return null;}};k.New.call(ct);return ct;}},Y,Z);_0=c.AnimatedAttrNode=b_.Class({sync:function(ct){var cu;if(this.dirty){cu=this.logical;if(cu==null);else(this.push(ct))(cu.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(ct,cu){this.visible={$:1,$0:cu};this.dirty=true;(this.push(ct))(cu);},NChanged:function(){return this.updates;},NSync:a.ignore,NGetExitAnim:function(ct){var cu,cv;cu=this;return T.WhenDone(function(){cu.dirty=true;cu.visible=null;},(cv=this.visible,cv!=null&&cv.$==1?T.Pack(T.Map(function(cw){cu.pushVisible(ct,cw);},V.AnimateExit(this.tr,cv.$0))):T.get_Empty()));},NGetEnterAnim:function(ct){var cu,cv,cw,cx,cy;cw=this;cx=this.visible;cy=this.logical;switch(cx==null?cy!=null&&cy.$==1?(cv=cy.$0,1):2:cy!=null&&cy.$==1?this.dirty?(cv=[cy.$0,cx.$0],0):2:2){case 0:cu=T.Pack(T.Map(function(cz){cw.pushVisible(ct,cz);},V.AnimateChange(this.tr,cv[1],cv[0])));break;case 1:cu=T.Pack(T.Map(function(cz){cw.pushVisible(ct,cz);},V.AnimateEnter(this.tr,cv)));break;case 2:cu=T.get_Empty();break;}return T.WhenDone(function(){cw.sync(ct);},cu);},NGetChangeAnim:function(ct){var cu,cv,cw,cx;cu=this;return T.WhenDone(function(){cu.sync(ct);},(cv=this.visible,(cw=this.logical,cv!=null&&cv.$==1&&(cw!=null&&cw.$==1&&(this.dirty&&(cx=[cw.$0,cv.$0],true)))?T.Pack(T.Map(function(cy){cu.pushVisible(ct,cy);},V.AnimateChange(this.tr,cx[1],cx[0]))):T.get_Empty())));}},k,_0);_0.New=b_.Ctor(function(ct,cu,cv){var cw;cw=this;k.New.call(this);this.tr=ct;this.push=cv;this.logical=null;this.visible=null;this.dirty=true;this.updates=y.Map(function(cx){cw.logical={$:1,$0:cx};cw.dirty=true;},cu);},_0);_1=c.DynamicAttrNode=b_.Class({NChanged:function(){return this.updates;},NSync:function(ct){if(this.dirty){(this.push(ct))(this.value);this.dirty=false;}},NGetExitAnim:function(ct){return T.get_Empty();},NGetEnterAnim:function(ct){return T.get_Empty();},NGetChangeAnim:function(ct){return T.get_Empty();}},k,_1);_1.New=b_.Ctor(function(ct,cu){var cv;cv=this;k.New.call(this);this.push=cu;this.value=void 0;this.dirty=false;this.updates=y.Map(function(cw){cv.value=cw;cv.dirty=true;},ct);},_1);_2=c.AttrProxy=b_.Class({},null,_2);_2.Handler=function(ct,cu){return _2.HandlerImpl(ct,cu);};_2.HandlerImpl=function(ct,cu){return _6.Static(function(cv){cv.addEventListener(ct,function(cw){return(cu(cv))(cw);},false);});};_2.OnAfterRenderImpl=function(ct){return new _2({$:4,$0:ct});};_2.Concat=function(ct){var cu;cu=d.ofSeqNonCopying(ct);return d.TreeReduce(_6.EmptyAttr(),_2.Append,cu);};_2.Append=function(ct,cu){return _6.AppendTree(ct,cu);};_2.Create=function(ct,cu){return _6.Static(function(cv){cv.setAttribute(ct,cu);});};_5.New=function(ct,cu,cv,cw){var cx;cx={DynElem:ct,DynFlags:cu,DynNodes:cv};b_.SetOptional(cx,"OnAfterRender",cw);return cx;};_6.Static=function(ct){return new _2({$:3,$0:ct});};_6.Dynamic=function(ct,cu){return new _2({$:1,$0:new _1.New(ct,cu)});};_6.Animated=function(ct,cu,cv){var cw,cx,cy;cw=new _0.New(ct,cu,cv);cx=4;if(V.CanAnimateEnter(ct))cx=cx|1;if(V.CanAnimateExit(ct))cx=cx|2;cy=new _2({$:1,$0:cw});_6.SetFlags(cy,cx);return cy;};_6.EmptyAttr=function(){_.$cctor();return _.EmptyAttr;};_6.AppendTree=function(ct,cu){var cv;return ct===null?cu:cu===null?ct:(cv=new _2({$:2,$0:ct,$1:cu}),(_6.SetFlags(cv,_6.Flags(ct)|_6.Flags(cu)),cv));};_6.GetChangeAnim=function(ct){return _6.GetAnim(ct,function(cu,cv){return cu.NGetChangeAnim(cv);});};_6.GetExitAnim=function(ct){return _6.GetAnim(ct,function(cu,cv){return cu.NGetExitAnim(cv);});};_6.GetEnterAnim=function(ct){return _6.GetAnim(ct,function(cu,cv){return cu.NGetEnterAnim(cv);});};_6.GetAnim=function(ct,cu){return T.Concat(b3.map(function(cv){return cu(cv,ct.DynElem);},ct.DynNodes));};_6.Updates=function(ct){return d.MapTreeReduce(function(cu){return cu.NChanged();},y.Const(),y.Map2Unit,ct.DynNodes);};_6.Empty=function(ct){return _5.New(ct,0,[],null);};_6.Insert=function(ct,cu){var cv,cw,cx;function cy(cz){var cA,cB;while(true)if(!(cz===null)){if(cz!=null&&cz.$==1)return cv.push(cz.$0);else if(cz!=null&&cz.$==2){cA=cz.$1;cB=cz.$0;cy(cB);cz=cA;}else return cz!=null&&cz.$==3?cz.$0(ct):cz!=null&&cz.$==4?cw.push(cz.$0):null;}else return null;}cv=[];cw=[];cy(cu);cx=cv.slice(0);return _5.New(ct,_6.Flags(cu),cx,cw.length===0?null:{$:1,$0:function(cz){b9.iter(function(cA){cA(cz);},cw);}});};_6.Sync=function(ct,cu){b3.iter(function(cv){cv.NSync(ct);},cu.DynNodes);};_6.SetFlags=function(ct,cu){ct.flags=cu;};_6.Flags=function(ct){return ct!==null&&ct.hasOwnProperty("flags")?ct.flags:0;};_6.HasExitAnim=function(ct){var cu;cu=2;return(ct.DynFlags&cu)===cu;};_6.HasEnterAnim=function(ct){var cu;cu=1;return(ct.DynFlags&cu)===cu;};_6.HasChangeAnim=function(ct){var cu;cu=4;return(ct.DynFlags&cu)===cu;};_7=c.CheckedInput=b_.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_7);_7.Make=function(ct){var cu;return new _7({$:0,$0:ct,$1:(cu=ct,a.String(cu))});};_8.DecimalApplyChecked=function(ct){return _8.ApplyValue(_8.DecimalGetChecked,function(cu){return function(cv){return _8.DecimalSetChecked(cu,cv);};},ct);};_8.DecimalGetChecked=function(ct){var cu,cv,cw,cx,cy,cz;cz=ct.value;if(e.isBlank(cz))cu=(ct.checkValidity?ct.checkValidity():true)?new _7({$:2,$0:cz}):new _7({$:1,$0:cz});else{cw=0;try{cy=(cw=cj.WSDecimalMath().bignumber(cz),true);}catch(cA){cy=false;}cv=[cy,cw];cu=cv[0]?new _7({$:0,$0:cv[1],$1:cz}):new _7({$:1,$0:cz});}return{$:1,$0:cu};};_8.DecimalSetChecked=function(ct,cu){var cv;cv=cu.get_Input();if(ct.value!=cv)ct.value=cv;};_8.DecimalApplyUnchecked=function(ct){return _8.ApplyValue(_8.DecimalGetUnchecked,function(cu){return function(cv){return _8.DecimalSetUnchecked(cu,cv);};},ct);};_8.DecimalGetUnchecked=function(ct){var cu,cv,cw,cx,cy;cy=ct.value;if(e.isBlank(cy))return{$:1,$0:cj.CreateDecimal(0,0,0,false,1)};else{cv=0;try{cx=(cv=cj.WSDecimalMath().bignumber(cy),true);}catch(cz){cx=false;}cu=[cx,cv];return cu[0]?{$:1,$0:cu[1]}:null;}};_8.DecimalSetUnchecked=function(ct,cu){ct.value=a.String(cu);};_8.FloatApplyChecked=function(){_.$cctor();return _.FloatApplyChecked;};_8.FloatGetChecked=function(){_.$cctor();return _.FloatGetChecked;};_8.FloatSetChecked=function(){_.$cctor();return _.FloatSetChecked;};_8.FloatApplyUnchecked=function(){_.$cctor();return _.FloatApplyUnchecked;};_8.FloatGetUnchecked=function(){_.$cctor();return _.FloatGetUnchecked;};_8.FloatSetUnchecked=function(){_.$cctor();return _.FloatSetUnchecked;};_8.IntApplyChecked=function(){_.$cctor();return _.IntApplyChecked;};_8.IntGetChecked=function(){_.$cctor();return _.IntGetChecked;};_8.IntSetChecked=function(){_.$cctor();return _.IntSetChecked;};_8.IntApplyUnchecked=function(){_.$cctor();return _.IntApplyUnchecked;};_8.IntGetUnchecked=function(){_.$cctor();return _.IntGetUnchecked;};_8.IntSetUnchecked=function(){_.$cctor();return _.IntSetUnchecked;};_8.FileApplyUnchecked=function(){_.$cctor();return _.FileApplyUnchecked;};_8.FileGetUnchecked=function(){_.$cctor();return _.FileGetUnchecked;};_8.FileSetUnchecked=function(){_.$cctor();return _.FileSetUnchecked;};_8.DateTimeApplyUnchecked=function(){_.$cctor();return _.DateTimeApplyUnchecked;};_8.DateTimeGetUnchecked=function(){_.$cctor();return _.DateTimeGetUnchecked;};_8.DateTimeSetUnchecked=function(){_.$cctor();return _.DateTimeSetUnchecked;};_8.StringApply=function(){_.$cctor();return _.StringApply;};_8.StringGet=function(){_.$cctor();return _.StringGet;};_8.StringSet=function(){_.$cctor();return _.StringSet;};_8.BoolCheckedApply=function(){_.$cctor();return _.BoolCheckedApply;};_8.FileApplyValue=function(ct,cu,cv){var cw;function cx(cy,cz){return cz==null?null:cy(cz.$0);}cw=null;return[function(cy){cy.addEventListener("change",function(){cv.UpdateMaybe(function(cz){var cA;cw=ct(cy);return cw!=null&&cw.$==1&&(cw.$0!==cz&&(cA=[cw,cw.$0],true))?cA[0]:null;});});},function(cy){var cz;cz=cu(cy);return function(cA){return cx(cz,cA);};},y.Map(function(cy){var cz;return cw!=null&&cw.$==1&&(b$.Equals(cw.$0,cy)&&(cz=cw.$0,true))?null:{$:1,$0:cy};},cv.get_View())];};_8.ApplyValue=function(ct,cu,cv){var cw;function cx(cy,cz){return cz==null?null:cy(cz.$0);}cw=null;return[function(cy){function cz(){cv.UpdateMaybe(function(cA){var cB;cw=ct(cy);return cw!=null&&cw.$==1&&(!b$.Equals(cw.$0,cA)&&(cB=[cw,cw.$0],true))?cB[0]:null;});}cy.addEventListener("change",cz);cy.addEventListener("input",cz);cy.addEventListener("keypress",cz);},function(cy){var cz;cz=cu(cy);return function(cA){return cx(cz,cA);};},y.Map(function(cy){var cz;return cw!=null&&cw.$==1&&(b$.Equals(cw.$0,cy)&&(cz=cw.$0,true))?null:{$:1,$0:cy};},cv.get_View())];};_9.ValidateForm=function(){return _9.OnAfterRender(function(ct){if(self.H5F)self.H5F.setup(ct);});};_9.Checked=function(ct){return _9.ValueWith(_8.BoolCheckedApply(),ct);};_9.DecimalValue=function(ct){return _9.ValueWith(_8.DecimalApplyChecked,ct);};_9.DecimalValueUnchecked=function(ct){return _9.ValueWith(_8.DecimalApplyUnchecked,ct);};_9.FloatValue=function(ct){return _9.ValueWith(_8.FloatApplyChecked(),ct);};_9.FloatValueUnchecked=function(ct){return _9.ValueWith(_8.FloatApplyUnchecked(),ct);};_9.IntValue=function(ct){return _9.ValueWith(_8.IntApplyChecked(),ct);};_9.IntValueUnchecked=function(ct){return _9.ValueWith(_8.IntApplyUnchecked(),ct);};_9.FileValue=function(ct){return _9.ValueWith(_8.FileApplyUnchecked(),ct);};_9.DateTimeValue=function(ct){return _9.ValueWith(_8.DateTimeApplyUnchecked(),ct);};_9.Value=function(ct){return _9.ValueWith(_8.StringApply(),ct);};_9.ContentEditableHtml=function(ct){var cu;cu=_9.CustomVar(ct,function(cv){return function(cw){cv.innerHTML=cw;};},function(cv){return{$:1,$0:cv.innerHTML};});return _2.Append(_2.Create("contenteditable","true"),cu);};_9.ContentEditableText=function(ct){var cu;cu=_9.CustomVar(ct,function(cv){return function(cw){cv.textContent=cw;};},function(cv){return{$:1,$0:cv.textContent};});return _2.Append(_2.Create("contenteditable","true"),cu);};_9.CustomValue=function(ct,cu,cv){return _9.CustomVar(ct,function(cw){return function(cx){cw.value=cu(cx);};},function(cw){return cv(cw.value);});};_9.CustomVar=function(ct,cu,cv){return _9.ValueWith(function(cw){return _8.ApplyValue(cv,cu,cw);},ct);};_9.ValueWith=function(ct,cu){var cv;cv=ct(cu);return _2.Append(_6.Static(cv[0]),_9.DynamicCustom(cv[1],cv[2]));};_9.DynamicProp=function(ct,cu){return _6.Dynamic(cu,function(cv){return function(cw){cv[ct]=cw;};});};_9.Prop=function(ct,cu){return _6.Static(function(cv){cv[ct]=cu;});};_9.DynamicBool=function(ct,cu){function cv(cw,cx){return cx?cw.setAttribute(ct,""):cw.removeAttribute(ct);}return _6.Dynamic(cu,function(cw){return function(cx){return cv(cw,cx);};});};_9.DynamicPred=function(ct,cu,cv){function cw(cx,cy){return cy[0]?cx.setAttribute(ct,cy[1]):cx.removeAttribute(ct);}return _6.Dynamic(y.Map2(function(cx,cy){return[cx,cy];},cu,cv),function(cx){return function(cy){return cw(cx,cy);};});};_9.DynamicClass=function(ct,cu,cv){return _9.DynamicClassPred(ct,y.Map(cv,cu));};_9.Class=function(ct){return _9.ClassPred(ct,true);};_9.ClassPred=function(ct,cu){return _6.Static(function(cv){if(cu)r.AddClass(cv,ct);else r.RemoveClass(cv,ct);});};_9.DynamicClassPred=function(ct,cu){return _6.Dynamic(cu,function(cv){return function(cw){return cw?r.AddClass(cv,ct):r.RemoveClass(cv,ct);};});};_9.OnAfterRenderView=function(ct,cu){var cv;cv=h.Id();return _2.Append(_9.OnAfterRender(function(cw){cu(cw,cw[cv]);}),_9.DynamicCustom(function(cw){return function(cx){cw[cv]=cx;};},ct));};_9.OnAfterRender=function(ct){return new _2({$:4,$0:ct});};_9.HandlerView=function(ct,cu,cv){return _6.Static(function(cw){var cx;cx=cv(cw);cw.addEventListener(ct,function(cy){return y.Get(cx(cy),cu);},false);});};_9.Handler=function(ct,cu){return _6.Static(function(cv){cv.addEventListener(ct,function(cw){return(cu(cv))(cw);},false);});};_9.DynamicStyle=function(ct,cu){return _6.Dynamic(cu,function(cv){return function(cw){return cv.style.setProperty(ct,cw);};});};_9.DynamicCustom=function(ct,cu){return _6.Dynamic(cu,ct);};_9.Dynamic=function(ct,cu){return _6.Dynamic(cu,function(cv){return function(cw){return cv.setAttribute(ct,cw);};});};_9.AnimatedStyle=function(ct,cu,cv,cw){return _6.Animated(cu,cv,function(cx){return function(cy){var cz;cz=cw(cy);return cx.style.setProperty(ct,cz);};});};_9.Animated=function(ct,cu,cv,cw){return _6.Animated(cu,cv,function(cx){return function(cy){return cx.setAttribute(ct,cw(cy));};});};_9.Style=function(ct,cu){return _6.Static(function(cv){cv.style.setProperty(ct,cu);});};_.$cctor=function(){var ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG;_.$cctor=a.ignore;_.EmptyAttr=null;_.BoolCheckedApply=function(cH){function cI(cJ,cK){return cK!=null&&cK.$==1?void(cJ.checked=cK.$0):null;}return[function(cJ){cJ.addEventListener("change",function(){return cH.Get()!=cJ.checked?cH.Set(cJ.checked):null;});},function(cJ){return function(cK){return cI(cJ,cK);};},y.Map(function(cJ){return{$:1,$0:cJ};},cH.get_View())];};_.StringSet=function(cH){return function(cI){cH.value=cI;};};_.StringGet=function(cH){return{$:1,$0:cH.value};};_.StringApply=(ct=_8.StringGet(),(cu=_8.StringSet(),function(cH){return _8.ApplyValue(ct,cu,cH);}));_.DateTimeSetUnchecked=function(cH){return function(cI){cH.value=(new a.Date(cI)).toLocaleString();};};_.DateTimeGetUnchecked=function(cH){var cI,cJ,cK,cL;cI=cH.value;return e.isBlank(cI)?{$:1,$0:-8640000000000000}:(cJ=(cK=0,[(cL=ck.TryParse(cI),cL!=null&&cL.$==1&&(cK=cL.$0,true)),cK]),cJ[0]?{$:1,$0:cJ[1]}:null);};_.DateTimeApplyUnchecked=(cv=_8.DateTimeGetUnchecked(),(cw=_8.DateTimeSetUnchecked(),function(cH){return _8.ApplyValue(cv,cw,cH);}));_.FileSetUnchecked=function(){return function(){return null;};};_.FileGetUnchecked=function(cH){var cI;cI=cH.files;return{$:1,$0:b3.ofSeq(b9.delay(function(){return b9.map(function(cJ){return cI.item(cJ);},ce.range(0,cI.length-1));}))};};_.FileApplyUnchecked=(cx=_8.FileGetUnchecked(),(cy=_8.FileSetUnchecked(),function(cH){return _8.FileApplyValue(cx,cy,cH);}));_.IntSetUnchecked=function(cH){return function(cI){cH.value=a.String(cI);};};_.IntGetUnchecked=function(cH){var cI,cJ;cI=cH.value;return e.isBlank(cI)?{$:1,$0:0}:(cJ=+cI,cJ!==cJ>>0?null:{$:1,$0:cJ});};_.IntApplyUnchecked=(cz=_8.IntGetUnchecked(),(cA=_8.IntSetUnchecked(),function(cH){return _8.ApplyValue(cz,cA,cH);}));_.IntSetChecked=function(cH){return function(cI){var cJ;cJ=cI.get_Input();return cH.value!=cJ?void(cH.value=cJ):null;};};_.IntGetChecked=function(cH){var cI,cJ,cK;cI=cH.value;return{$:1,$0:e.isBlank(cI)?(cH.checkValidity?cH.checkValidity():true)?new _7({$:2,$0:cI}):new _7({$:1,$0:cI}):(cJ=(cK=0,[cl.TryParseInt32(cI,{get:function(){return cK;},set:function(cL){cK=cL;}}),cK]),cJ[0]?new _7({$:0,$0:cJ[1],$1:cI}):new _7({$:1,$0:cI}))};};_.IntApplyChecked=(cB=_8.IntGetChecked(),(cC=_8.IntSetChecked(),function(cH){return _8.ApplyValue(cB,cC,cH);}));_.FloatSetUnchecked=function(cH){return function(cI){cH.value=a.String(cI);};};_.FloatGetUnchecked=function(cH){var cI,cJ;cI=cH.value;return e.isBlank(cI)?{$:1,$0:0}:(cJ=+cI,a.isNaN(cJ)?null:{$:1,$0:cJ});};_.FloatApplyUnchecked=(cD=_8.FloatGetUnchecked(),(cE=_8.FloatSetUnchecked(),function(cH){return _8.ApplyValue(cD,cE,cH);}));_.FloatSetChecked=function(cH){return function(cI){var cJ;cJ=cI.get_Input();return cH.value!=cJ?void(cH.value=cJ):null;};};_.FloatGetChecked=function(cH){var cI,cJ;cI=cH.value;return{$:1,$0:e.isBlank(cI)?(cH.checkValidity?cH.checkValidity():true)?new _7({$:2,$0:cI}):new _7({$:1,$0:cI}):(cJ=+cI,a.isNaN(cJ)?new _7({$:1,$0:cI}):new _7({$:0,$0:cJ,$1:cI}))};};_.FloatApplyChecked=(cF=_8.FloatGetChecked(),(cG=_8.FloatSetChecked(),function(cH){return _8.ApplyValue(cF,cG,cH);}));};$=c.TemplateHole=b_.Class({get_AsChoiceView:function(){ca.warn("Attribute value hole filled with non-text data",this.get_Name());return{$:0,$0:""};},ForTextView:function(){ca.warn("Content hole filled with attribute data",this.get_Name());return null;},ApplyVarHole:function(ct){ca.warn("Not a var hole: ",this.get_Name());},AddAttribute:function(ct,cu){ca.warn("Var hole filled with non-Var data",this.get_Name());}},k,$);$.Value=function(ct){return ct.get_ValueObj();};$.New=b_.Ctor(function(){k.New.call(this);},$);bb=ba.Elt=b_.Class({WithName:function(ct){return new bb.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bb);bb.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bb);bc=ba.Text=b_.Class({get_AsChoiceView:function(){return{$:0,$0:this.fillWith};},WithName:function(ct){return new bc.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bc);bc.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bc);bd=ba.TextView=b_.Class({ForTextView:function(){return{$:1,$0:this.fillWith};},get_AsChoiceView:function(){return{$:1,$0:this.fillWith};},WithName:function(ct){return new bd.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bd);bd.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bd);be=ba.Attribute=b_.Class({WithName:function(ct){return new be.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,be);be.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},be);bf=ba.Event=b_.Class({WithName:function(ct){return new bf.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bf);bf.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bf);bg=ba.EventQ=b_.Class({WithName:function(ct){return new bg.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bg);bg.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bg);bh=ba.EventE=b_.Class({WithName:function(ct){return new bh.New(ct,this.key,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},Key:function(){return this.key;},get_Value:function(){return this.fillWith;}},$,bh);bh.New=b_.Ctor(function(ct,cu,cv){$.New.call(this);this.name=ct;this.key=cu;this.fillWith=cv;},bh);bi=ba.AfterRender=b_.Class({WithName:function(ct){return new bi.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bi);bi.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bi);bj=ba.AfterRenderQ=b_.Class({WithName:function(ct){return new bj.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bj);bj.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bj);bk=ba.AfterRenderE=b_.Class({WithName:function(ct){return new bk.New(ct,this.key,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},Key:function(){return this.key;},get_Value:function(){return this.fillWith;}},$,bk);bk.New=b_.Ctor(function(ct,cu,cv){$.New.call(this);this.name=ct;this.key=cu;this.fillWith=cv;},bk);bl=ba.VarStr=b_.Class({ForTextView:function(){return{$:1,$0:this.fillWith.get_View()};},get_AsChoiceView:function(){return{$:1,$0:y.Map(a.String,this.fillWith.get_View())};},AddAttribute:function(ct,cu){(ct(cu))(_9.Value(this.fillWith));},ApplyVarHole:function(ct){ba.applyTypedVarHole(_8.StringApply(),this.fillWith,ct);},WithName:function(ct){return new bl.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bl);bl.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bl);bm=ba.VarBool=b_.Class({ForTextView:function(){return{$:1,$0:y.Map(a.String,this.fillWith.get_View())};},get_AsChoiceView:function(){return{$:1,$0:y.Map(a.String,this.fillWith.get_View())};},AddAttribute:function(ct,cu){(ct(cu))(_9.Checked(this.fillWith));},ApplyVarHole:function(ct){ba.applyTypedVarHole(_8.BoolCheckedApply(),this.fillWith,ct);},WithName:function(ct){return new bm.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bm);bm.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bm);bn=ba.VarDateTime=b_.Class({ForTextView:function(){return{$:1,$0:y.Map(function(ct){return(new a.Date(ct)).toLocaleString();},this.fillWith.get_View())};},get_AsChoiceView:function(){return{$:1,$0:y.Map(function(ct){return(new a.Date(ct)).toLocaleString();},this.fillWith.get_View())};},AddAttribute:function(ct,cu){(ct(cu))(_9.DateTimeValue(this.fillWith));},ApplyVarHole:function(ct){ba.applyTypedVarHole(_8.DateTimeApplyUnchecked(),this.fillWith,ct);},WithName:function(ct){return new bn.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bn);bn.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bn);bo=ba.VarFile=b_.Class({ForTextView:function(){return{$:1,$0:y.Map(a.String,this.fillWith.get_View())};},get_AsChoiceView:function(){return{$:1,$0:y.Map(a.String,this.fillWith.get_View())};},AddAttribute:function(ct,cu){(ct(cu))(_9.FileValue(this.fillWith));},ApplyVarHole:function(ct){ba.applyTypedVarHole(_8.FileApplyUnchecked(),this.fillWith,ct);},WithName:function(ct){return new bo.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bo);bo.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bo);bp=ba.VarDomElement=b_.Class({ApplyVarHole:a.ignore,WithName:function(ct){return new bp.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bp);bp.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bp);bq=ba.VarInt=b_.Class({ForTextView:function(){return{$:1,$0:y.Map(function(ct){return ct.get_Input();},this.fillWith.get_View())};},get_AsChoiceView:function(){return{$:1,$0:y.Map(function(ct){return ct.get_Input();},this.fillWith.get_View())};},AddAttribute:function(ct,cu){(ct(cu))(_9.IntValue(this.fillWith));},ApplyVarHole:function(ct){ba.applyTypedVarHole(_8.IntApplyChecked(),this.fillWith,ct);},WithName:function(ct){return new bq.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bq);bq.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bq);br=ba.VarIntUnchecked=b_.Class({ForTextView:function(){return{$:1,$0:y.Map(a.String,this.fillWith.get_View())};},get_AsChoiceView:function(){return{$:1,$0:y.Map(a.String,this.fillWith.get_View())};},AddAttribute:function(ct,cu){(ct(cu))(_9.IntValueUnchecked(this.fillWith));},ApplyVarHole:function(ct){ba.applyTypedVarHole(_8.IntApplyUnchecked(),this.fillWith,ct);},WithName:function(ct){return new br.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,br);br.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},br);bs=ba.VarFloat=b_.Class({ForTextView:function(){return{$:1,$0:y.Map(function(ct){return ct.get_Input();},this.fillWith.get_View())};},get_AsChoiceView:function(){return{$:1,$0:y.Map(function(ct){return ct.get_Input();},this.fillWith.get_View())};},AddAttribute:function(ct,cu){(ct(cu))(_9.FloatValue(this.fillWith));},ApplyVarHole:function(ct){ba.applyTypedVarHole(_8.FloatApplyChecked(),this.fillWith,ct);},WithName:function(ct){return new bs.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bs);bs.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bs);bt=ba.VarFloatUnchecked=b_.Class({ForTextView:function(){return{$:1,$0:y.Map(a.String,this.fillWith.get_View())};},get_AsChoiceView:function(){return{$:1,$0:y.Map(a.String,this.fillWith.get_View())};},AddAttribute:function(ct,cu){(ct(cu))(_9.FloatValueUnchecked(this.fillWith));},ApplyVarHole:function(ct){ba.applyTypedVarHole(_8.FloatApplyUnchecked(),this.fillWith,ct);},WithName:function(ct){return new bt.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bt);bt.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bt);bu=ba.VarDecimal=b_.Class({ForTextView:function(){return{$:1,$0:y.Map(function(ct){return ct.get_Input();},this.fillWith.get_View())};},get_AsChoiceView:function(){return{$:1,$0:y.Map(function(ct){return ct.get_Input();},this.fillWith.get_View())};},AddAttribute:function(ct,cu){(ct(cu))(_9.DecimalValue(this.fillWith));},ApplyVarHole:function(ct){ba.applyTypedVarHole(_8.DecimalApplyChecked,this.fillWith,ct);},WithName:function(ct){return new bu.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bu);bu.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bu);bv=ba.VarDecimalUnchecked=b_.Class({ForTextView:function(){return{$:1,$0:y.Map(a.String,this.fillWith.get_View())};},get_AsChoiceView:function(){return{$:1,$0:y.Map(a.String,this.fillWith.get_View())};},AddAttribute:function(ct,cu){(ct(cu))(_9.DecimalValueUnchecked(this.fillWith));},ApplyVarHole:function(ct){ba.applyTypedVarHole(_8.DecimalApplyUnchecked,this.fillWith,ct);},WithName:function(ct){return new bv.New(ct,this.fillWith);},get_ValueObj:function(){return this.get_Value();},get_Name:function(){return this.name;},get_Value:function(){return this.fillWith;}},$,bv);bv.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.fillWith=cu;},bv);bw=ba.UninitVar=b_.Class({WithName:function(ct){return new bw.New(ct,this.key);},get_ValueObj:function(){return this.key;},get_Name:function(){return this.name;},get_Value:function(){return this.key;}},$,bw);bw.New=b_.Ctor(function(ct,cu){$.New.call(this);this.name=ct;this.key=cu;},bw);ba.applyTypedVarHole=function(ct,cu,cv){var cw;cw=ct(cu);cw[0](cv);y.Sink(cw[1](cv),cw[2]);};by=c.InlineControlWithPlaceHolder=b_.Class({get_Body:function(){return bx.prototype.get_Body.call(this);}},bx,by);bz.BatchUpdatesEnabled=function(){bJ.$cctor();return bJ.BatchUpdatesEnabled;};bz.set_BatchUpdatesEnabled=function(ct){bJ.$cctor();bJ.BatchUpdatesEnabled=ct;};bA=c.DocElemNode=b_.Class({GetHashCode:function(){return this.ElKey;},Equals:function(ct){return this.ElKey===ct.ElKey;}},null,bA);bA.New=function(ct,cu,cv,cw,cx,cy){var cz;return new bA((cz={Attr:ct,Children:cu,El:cw,ElKey:cx},(b_.SetOptional(cz,"Delimiters",cv),b_.SetOptional(cz,"Render",cy),cz)));};bC.FoldBack=function(ct,cu,cv){return b3.foldBack(ct,cu.$0,cv);};bC.Iter=function(ct,cu){b3.iter(ct,cu.$0);};bC.Except=function(ct,cu){var cv;cv=ct.$0;return{$:0,$0:b3.filter(function(cw){return b3.forall(function(cx){return!(cw===cx);},cv);},cu.$0)};};bC.DocChildren=function(ct){var cu;function cv(cw){var cx,cy,cz,cA;while(true){if(cw!=null&&cw.$==2){cy=cw.$0;cw=cy.Current;}else if(cw!=null&&cw.$==1)return cu.push(cw.$0.El);else if(cw==null)return null;else if(cw!=null&&cw.$==5)return cu.push(cw.$0);else if(cw!=null&&cw.$==4)return cu.push(cw.$0.Text);else if(cw!=null&&cw.$==6){cx=cw.$0.Els;return(function(cB){return function(cC){b3.iter(cB,cC);};}(function(cB){if(cB==null||cB.constructor===a.Object)cv(cB);else cu.push(cB);}))(cx);}else{cz=cw.$1;cA=cw.$0;cv(cA);cw=cz;}}}cu=[];cv(ct.Children);return{$:0,$0:d.ofSeqNonCopying(cu)};};bC.Children=function(ct,cu){var cv,cw,cx;if(cu!=null&&cu.$==1){cx=[];cv=cu.$0[0].nextSibling;while(cv!==cu.$0[1]){cx.push(cv);cv=cv.nextSibling;}return{$:0,$0:cx};}else return{$:0,$0:b3.init(ct.childNodes.length,(cw=ct.childNodes,function(cy){return cw[cy];}))};};bD.ToArray=function(ct){return i.ToArray(ct.$0);};bD.get_Empty=function(){return{$:0,$0:new b8.New$3()};};bD.IsEmpty=function(ct){return ct.$0.Count()===0;};bD.Intersect=function(ct,cu){return{$:0,$0:i.Intersect(ct.$0,cu.$0)};};bD.Except=function(ct,cu){return{$:0,$0:i.Except(ct.$0,cu.$0)};};bD.FindAll=function(ct){var cu;function cv(cy,cz){var cA,cB,cC,cD,cE;while(true)switch(cy){case 0:if(cz!=null&&cz.$==0){cB=cz.$1;cC=cz.$0;cv(0,cC);cz=cB;}else if(cz!=null&&cz.$==1){cD=cz.$0;cz=cD;cy=1;}else if(cz!=null&&cz.$==2){cE=cz.$0;cz=cE.Current;}else return cz!=null&&cz.$==6?(cA=cz.$0.Holes,(function(cF){return function(cG){b3.iter(cF,cG);};}(cx))(cA)):null;break;case 1:cu.push(cz);cz=cz.Children;cy=0;break;}}function cw(cy){return cv(0,cy);}function cx(cy){return cv(1,cy);}cu=[];cw(ct);return{$:0,$0:new b8.New$2(cu)};};bD.Filter=function(ct,cu){return{$:0,$0:i.Filter(ct,cu.$0)};};bE.New=function(ct,cu){return{PreviousNodes:ct,Top:cu};};bF.UpdateTextNode=function(ct,cu){ct.Value=cu;ct.Dirty=true;};bF.CreateTextNode=function(){return{Text:self.document.createTextNode(""),Dirty:false,Value:""};};bF.UpdateEmbedNode=function(ct,cu){ct.Current=cu;ct.Dirty=true;};bF.CreateEmbedNode=function(){return{Current:null,Dirty:false};};bF.PerformSyncUpdate=function(ct,cu,cv){var cw;cw=bD.FindAll(cv);bF.SyncElemNode(ct,cu.Top);cu.PreviousNodes=cw;};bF.PerformAnimatedUpdate=function(ct,cu,cv){var cw;return T.get_UseAnimations()?(cw=null,cb.Delay(function(){var cx,cy,cz;cx=bD.FindAll(cv);cy=bF.ComputeChangeAnim(cu,cx);cz=bF.ComputeEnterAnim(cu,cx);return cb.Bind(T.Play(T.Append(cy,bF.ComputeExitAnim(cu,cx))),function(){return cb.Bind(bF.SyncElemNodesNextFrame(ct,cu),function(){return cb.Bind(T.Play(cz),function(){cu.PreviousNodes=cx;return cb.Return(null);});});});})):bF.SyncElemNodesNextFrame(ct,cu);};bF.SyncElemNodesNextFrame=function(ct,cu){function cv(cw){a.requestAnimationFrame(function(){bF.SyncElemNode(ct,cu.Top);cw();});}return bz.BatchUpdatesEnabled()?cb.FromContinuations(function(cw,cx,cy){return cv.apply(null,[cw,cx,cy]);}):(bF.SyncElemNode(ct,cu.Top),cb.Return(null));};bF.ComputeEnterAnim=function(ct,cu){return T.Concat(b3.map(function(cv){return _6.GetEnterAnim(cv.Attr);},bD.ToArray(bD.Except(ct.PreviousNodes,bD.Filter(function(cv){return _6.HasEnterAnim(cv.Attr);},cu)))));};bF.ComputeChangeAnim=function(ct,cu){var cv;function cw(cx){return _6.HasChangeAnim(cx.Attr);}cv=function(cx){return bD.Filter(cw,cx);};return T.Concat(b3.map(function(cx){return _6.GetChangeAnim(cx.Attr);},bD.ToArray(bD.Intersect(cv(ct.PreviousNodes),cv(cu)))));};bF.ComputeExitAnim=function(ct,cu){return T.Concat(b3.map(function(cv){return _6.GetExitAnim(cv.Attr);},bD.ToArray(bD.Except(cu,bD.Filter(function(cv){return _6.HasExitAnim(cv.Attr);},ct.PreviousNodes)))));};bF.CreateDelimitedRunState=function(ct,cu,cv){return bE.New(bD.get_Empty(),bF.CreateDelimitedElemNode(ct,cu,_6.EmptyAttr(),cv));};bF.CreateRunState=function(ct,cu){return bE.New(bD.get_Empty(),bF.CreateElemNode(ct,_6.EmptyAttr(),cu));};bF.CreateDelimitedElemNode=function(ct,cu,cv,cw){var cx,cy;cx=ct.parentNode;bF.LinkPrevElement(cu,cw);cy=_6.Insert(cx,cv);return bA.New(cy,cw,{$:1,$0:[ct,cu]},cx,h.Int(),b_.GetOptional(cy.OnAfterRender));};bF.CreateElemNode=function(ct,cu,cv){var cw;bF.LinkElement(ct,cv);cw=_6.Insert(ct,cu);return bA.New(cw,cv,null,ct,h.Int(),b_.GetOptional(cw.OnAfterRender));};bF.SyncElemNode=function(ct,cu){!ct?bF.SyncElement(cu):void 0;bF.Sync(cu.Children);bF.AfterRender(cu);};bF.Sync=function(ct){var cu,cv,cw,cx,cy;while(true){if(ct!=null&&ct.$==1)return bF.SyncElemNode(false,ct.$0);else if(ct!=null&&ct.$==2){cw=ct.$0;ct=cw.Current;}else if(ct==null)return null;else if(ct!=null&&ct.$==5)return null;else if(ct!=null&&ct.$==4){cu=ct.$0;return cu.Dirty?(cu.Text.nodeValue=cu.Value,cu.Dirty=false):null;}else if(ct!=null&&ct.$==6){cv=ct.$0;b3.iter(function(cz){bF.SyncElemNode(false,cz);},cv.Holes);b3.iter(function(cz){_6.Sync(cz[0],cz[1]);},cv.Attrs);return bF.AfterRender(cv);}else{cx=ct.$1;cy=ct.$0;bF.Sync(cy);ct=cx;}}};bF.AfterRender=function(ct){var cu;cu=b_.GetOptional(ct.Render);if(cu!=null&&cu.$==1){cu.$0(ct.El);b_.SetOptional(ct,"Render",null);}};bF.InsertBeforeDelim=function(ct,cu){var cv,cw;cv=ct.parentNode;cw=self.document.createTextNode("");cv.insertBefore(cw,ct);bF.LinkPrevElement(ct,cu);return cw;};bF.LinkPrevElement=function(ct,cu){bF.InsertDoc(ct.parentNode,cu,ct);};bF.LinkElement=function(ct,cu){bF.InsertDoc(ct,cu,null);};bF.SyncElement=function(ct){function cu(cv){function cw(cx){var cy,cz,cA,cB;while(true){if(cx!=null&&cx.$==0){cz=cx.$1;cA=cx.$0;if(cw(cA))return true;else cx=cz;}else if(cx!=null&&cx.$==2){cB=cx.$0;if(cB.Dirty)return true;else cx=cB.Current;}else return cx!=null&&cx.$==6&&(cy=cx.$0,cy.Dirty||b3.exists(cu,cy.Holes));}}return cw(cv.Children);}_6.Sync(ct.El,ct.Attr);if(cu(ct))bF.DoSyncElement(ct);};bF.DoSyncElement=function(ct){var cu,cv,cw;function cx(cy,cz){var cA,cB,cC,cD;while(true){if(cy!=null&&cy.$==1)return cy.$0.El;else if(cy!=null&&cy.$==2){cB=cy.$0;if(cB.Dirty){cB.Dirty=false;return bF.InsertDoc(cu,cB.Current,cz);}else cy=cB.Current;}else if(cy==null)return cz;else if(cy!=null&&cy.$==4)return cy.$0.Text;else if(cy!=null&&cy.$==5)return cy.$0;else if(cy!=null&&cy.$==6){cA=cy.$0;cA.Dirty?cA.Dirty=false:void 0;return b3.foldBack(function(cE,cF){return cE==null||cE.constructor===a.Object?cx(cE,cF):cE;},cA.Els,cz);}else{cC=cy.$1;cD=cy.$0;cy=cD;cz=cx(cC,cz);}}}cu=ct.El;bC.Iter((cv=ct.El,function(cy){r.RemoveNode(cv,cy);}),bC.Except(bC.DocChildren(ct),bC.Children(ct.El,b_.GetOptional(ct.Delimiters))));cx(ct.Children,(cw=b_.GetOptional(ct.Delimiters),cw!=null&&cw.$==1?cw.$0[1]:null));};bF.InsertDoc=function(ct,cu,cv){var cw,cx,cy;while(true)if(cu!=null&&cu.$==1)return bF.InsertNode(ct,cu.$0.El,cv);else if(cu!=null&&cu.$==2){cw=cu.$0;cw.Dirty=false;cu=cw.Current;}else if(cu==null)return cv;else if(cu!=null&&cu.$==4)return bF.InsertNode(ct,cu.$0.Text,cv);else if(cu!=null&&cu.$==5)return bF.InsertNode(ct,cu.$0,cv);else if(cu!=null&&cu.$==6)return b3.foldBack(function(cz,cA){return(((b_.Curried3(function(cB,cC,cD){return cC==null||cC.constructor===a.Object?bF.InsertDoc(cB,cC,cD):bF.InsertNode(cB,cC,cD);}))(ct))(cz))(cA);},cu.$0.Els,cv);else{cx=cu.$1;cy=cu.$0;cu=cy;cv=bF.InsertDoc(ct,cx,cv);}};bF.InsertNode=function(ct,cu,cv){r.InsertAt(ct,cv,cu);return cu;};bG=c.Doc=b_.Class({ReplaceInDom:function(ct){var cu;cu=self.document.createTextNode("");ct.parentNode.replaceChild(cu,ct);bG.RunBefore(cu,this);}},k,bG);bG.SvgElementMixed=function(ct,cu){var cv;cv=bG.MixedNodes(cu);return bG.SvgElement(ct,cv[0],cv[1]);};bG.SvgElement=function(ct,cu,cv){var cw,cx;cw=_2.Concat(cu);cx=bG.Concat(cv);return bH.New(self.document.createElementNS("http://www.w3.org/2000/svg",ct),cw,cx);};bG.ElementMixed=function(ct,cu){var cv;cv=bG.MixedNodes(cu);return bG.Element(ct,cv[0],cv[1]);};bG.ConcatMixed=function(ct){return bG.Concat(b9.map(bG.ToMixedDoc,ct));};bG.MixedNodes=function(ct){var cu,cv,cw,cx;cu=b_.MarkResizable([]);cv=b_.MarkResizable([]);cw=b4.Get(ct);try{while(cw.MoveNext()){cx=cw.Current();if(cx instanceof _2)cu.push(cx);else cv.push(bG.ToMixedDoc(cx));}}finally{if(typeof cw=="object"&&"Dispose"in cw)cw.Dispose();}return[cu,cv];};bG.ToMixedDoc=function(ct){return ct instanceof bG?ct:typeof ct=="string"?bG.TextNode(ct):ct instanceof a.Element?bG.StaticProxy(ct):typeof ct=="function"?bG.EmbedView(y.Map(bG.ToMixedDoc,ct)):ct instanceof x?bG.EmbedView(y.Map(bG.ToMixedDoc,ct.get_View())):b$.Equals(ct,null)?bG.get_Empty():bG.TextNode(a.String(ct));};bG.Element=function(ct,cu,cv){var cw,cx;cw=_2.Concat(cu);cx=bG.Concat(cv);return bH.New(self.document.createElement(ct),cw,cx);};bG.Radio=function(ct,cu,cv){var cw,cx;cw=self.document.createElement("input");cw.addEventListener("click",function(){return cv.Set(cu);},false);cx=_9.DynamicProp("checked",y.Map(function(cy){return b$.Equals(cy,cu);},cv.get_View()));return bH.New(cw,_2.Concat(b2.append(b2.ofArray([_2.Create("type","radio"),_2.Create("name",cv.get_Id()),cx]),b2.ofSeq(ct))),bG.get_Empty());};bG.LinkView=function(ct,cu,cv,cw){var cx;cx=_2.Concat(b9.append([_9.HandlerView("click",cv,function(){return function(){return cw;};}),_2.Create("href","#")],cu));return bH.New(self.document.createElement("a"),cx,bG.TextNode(ct));};bG.Link=function(ct,cu,cv){var cw,cx;cw=(cx=_2.Concat(cu),_2.Append(_2.Create("href","#"),cx));return bH.New(bG.Clickable("a",cv),cw,bG.TextNode(ct));};bG.ButtonView=function(ct,cu,cv,cw){var cx;cx=_2.Concat(b9.append([_9.HandlerView("click",cv,function(){return function(){return cw;};})],cu));return bH.New(self.document.createElement("button"),cx,bG.TextNode(ct));};bG.Button=function(ct,cu,cv){var cw;cw=_2.Concat(cu);return bH.New(bG.Clickable("button",cv),cw,bG.TextNode(ct));};bG.Clickable=function(ct,cu){var cv;cv=self.document.createElement(ct);cv.addEventListener("click",function(cw){cw.preventDefault();return cu();},false);return cv;};bG.CheckBoxGroup=function(ct,cu,cv){function cw(cx){return b$.Equals(cu,cx);}return bG.CheckBox(ct,A.Lens(cv,function(cx){return b2.exists(cw,cx);},function(cx,cy){return cy?b2.exists(function(cz){return b$.Equals(cu,cz);},cx)?cx:new b2.T({$:1,$0:cu,$1:cx}):b2.filter(function(cz){return!b$.Equals(cu,cz);},cx);}));};bG.CheckBox=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_2.Create("type","checkbox"),_9.Checked(cu)]);});};bG.SelectDynOptional=function(ct,cu,cv,cw,cx){return bG.SelectDyn(ct,function(cy){return cy!=null&&cy.$==1?cv(cy.$0):cu;},y.Map(function(cy){return new b2.T({$:1,$0:null,$1:b2.map(function(cz){return{$:1,$0:cz};},cy)});},cw),cx);};bG.SelectOptional=function(ct,cu,cv,cw,cx){return bG.Select(ct,function(cy){return cy!=null&&cy.$==1?cv(cy.$0):cu;},new b2.T({$:1,$0:null,$1:b2.map(function(cy){return{$:1,$0:cy};},cw)}),cx);};bG.Select=function(ct,cu,cv,cw){return bG.SelectImpl(ct,cu,function(cx){cx[0]=cv;return bG.Concat(b2.mapi(function(cy,cz){return bG.Element("option",b2.ofArray([_2.Create("value",a.String(cy))]),b2.ofArray([bG.TextNode(cu(cz))]));},cv));},cw);};bG.SelectDyn=function(ct,cu,cv,cw){return bG.SelectImpl(ct,cu,function(cx){function cy(cz,cA){return bG.Element("option",b2.ofArray([_2.Create("value",a.String(cz))]),b2.ofArray([bG.TextNode(cu(cA))]));}return bG.Convert(function(cz){return cy(cz[0],cz[1]);},y.Map(function(cz){cx[0]=cz;return b9.mapi(function(cA,cB){return[cA,cB];},cz);},cv));},cw);};bG.SelectImpl=function(ct,cu,cv,cw){var cx,cy,cz,cA;function cB(cG){return cG.selectedIndex;}function cC(cG,cH){cG.selectedIndex=cH;}function cD(cG){var cH;cH=cB(cG);return cx[0].get_Item(cH);}function cE(cG){return b9.findIndex(function(cH){return b$.Equals(cG,cH);},cx[0]);}function cF(cG,cH){return cC(cG,cE(cH));}cx=[b2.T.Empty];cy=self.document.createElement("select");cz=_9.DynamicCustom(function(cG){return function(cH){return cF(cG,cH);};},cw.get_View());cy.addEventListener("change",function(){cw.UpdateMaybe(function(cG){var cH;cH=cD(cy);return b$.Equals(cG,cH)?null:{$:1,$0:cH};});},false);return bH.New(cy,(cA=_2.Append(cz,_2.Concat(ct)),_2.Append(_9.OnAfterRender(function(cG){cF(cG,cw.Get());}),cA)),cv(cx));};bG.InputArea=function(ct,cu){return bG.InputInternal("textarea",function(){return b9.append(ct,[_9.Value(cu)]);});};bG.RangeInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.IntValueUnchecked(cu),_2.Create("type","range")]);});};bG.WeekInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.Value(cu),_2.Create("type","week")]);});};bG.UrlInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.Value(cu),_2.Create("type","url")]);});};bG.TimeInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.Value(cu),_2.Create("type","time")]);});};bG.TelInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.Value(cu),_2.Create("type","tel")]);});};bG.SearchInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.Value(cu),_2.Create("type","search")]);});};bG.MonthInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.Value(cu),_2.Create("type","month")]);});};bG.FileInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.FileValue(cu),_2.Create("type","file")]);});};bG.EmailInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.Value(cu),_2.Create("type","email")]);});};bG.DateTimeLocalInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.DateTimeValue(cu),_2.Create("type","datetime-local")]);});};bG.DateInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.Value(cu),_2.Create("type","datetime")]);});};bG.ColorInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.Value(cu),_2.Create("type","color")]);});};bG.DecimalInput=function(ct,cu,cv){return bG.InputInternal("input",function(){return b9.append(ct,[_9.DecimalValue(cu),_2.Create("type","number"),_2.Create("step",a.String(cv))]);});};bG.DecimalInputUnchecked=function(ct,cu,cv){return bG.InputInternal("input",function(){var cw,cx;return b9.append(ct,[(cw=cu.Get(),(cx=cj.CreateDecimal(0,0,0,false,0),cj.WSDecimalMath().equal(cw,cx)))?_2.Create("value","0"):_6.EmptyAttr(),_9.DecimalValueUnchecked(cu),_2.Create("type","number"),_2.Create("step",a.String(cv))]);});};bG.FloatInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.FloatValue(cu),_2.Create("type","number")]);});};bG.FloatInputUnchecked=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[cu.Get()===0?_2.Create("value","0"):_6.EmptyAttr(),_9.FloatValueUnchecked(cu),_2.Create("type","number")]);});};bG.IntInput=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.IntValue(cu),_2.Create("type","number")]);});};bG.IntInputUnchecked=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[cu.Get()===0?_2.Create("value","0"):_6.EmptyAttr(),_9.IntValueUnchecked(cu),_2.Create("type","number")]);});};bG.PasswordBox=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.Value(cu),_2.Create("type","password")]);});};bG.Input=function(ct,cu){return bG.InputInternal("input",function(){return b9.append(ct,[_9.Value(cu)]);});};bG.InputInternal=function(ct,cu){var cv;cv=self.document.createElement(ct);return bH.New(cv,_2.Concat(cu(cv)),bG.get_Empty());};bG.ConvertSeqVarBy=function(ct,cu,cv){return bG.Flatten(A.MapLens(ct,cu,cv));};bG.ConvertSeqBy=function(ct,cu,cv){return bG.Flatten(y.MapSeqCachedViewBy(ct,function(cw,cx){return(cu(cw))(cx);},cv));};bG.ConvertSeq=function(ct,cu){return bG.Flatten(y.MapSeqCachedView(ct,cu));};bG.ConvertBy=function(ct,cu,cv){return bG.Flatten(y.MapSeqCachedBy(ct,cu,cv));};bG.Convert=function(ct,cu){return bG.Flatten(y.MapSeqCached(ct,cu));};bG.Flatten=function(ct){return bG.EmbedView(y.Map(bG.Concat,ct));};bG.TextView=function(ct){var cu;cu=bF.CreateTextNode();return bG.Mk({$:4,$0:cu},y.Map(function(cv){bF.UpdateTextNode(cu,cv);},ct));};bG.RunReplaceById=function(ct,cu){var cv;cv=self.document.getElementById(ct);if(b$.Equals(cv,null))ce.FailWith("invalid id: "+ct);else cu.ReplaceInDom(cv);};bG.RunById=function(ct,cu){var cv;cv=self.document.getElementById(ct);if(b$.Equals(cv,null))ce.FailWith("invalid id: "+ct);else bG.Run(cv,cu);};bG.Run=function(ct,cu){bF.LinkElement(ct,cu.docNode);bG.RunInPlace(false,ct,cu);};bG.RunInPlace=function(ct,cu,cv){var cw;cw=bF.CreateRunState(cu,cv.docNode);y.Sink(T.get_UseAnimations()||bz.BatchUpdatesEnabled()?n.StartProcessor(bF.PerformAnimatedUpdate(ct,cw,cv.docNode)):function(){bF.PerformSyncUpdate(ct,cw,cv.docNode);},cv.updates);};bG.RunPrependById=function(ct,cu){var cv;cv=self.document.getElementById(ct);if(b$.Equals(cv,null))ce.FailWith("invalid id: "+ct);else bG.RunPrepend(cv,cu);};bG.RunPrepend=function(ct,cu){var cv;cv=self.document.createTextNode("");ct.insertBefore(cv,ct.firstChild);bG.RunBefore(cv,cu);};bG.RunAppendById=function(ct,cu){var cv;cv=self.document.getElementById(ct);if(b$.Equals(cv,null))ce.FailWith("invalid id: "+ct);else bG.RunAppend(cv,cu);};bG.RunAppend=function(ct,cu){var cv;cv=self.document.createTextNode("");ct.appendChild(cv);bG.RunBefore(cv,cu);};bG.RunAfterById=function(ct,cu){var cv;cv=self.document.getElementById(ct);if(b$.Equals(cv,null))ce.FailWith("invalid id: "+ct);else bG.RunAfter(cv,cu);};bG.RunAfter=function(ct,cu){var cv;cv=self.document.createTextNode("");ct.parentNode.insertBefore(cv,ct.nextSibling);bG.RunBetween(ct,cv,cu);};bG.RunBeforeById=function(ct,cu){var cv;cv=self.document.getElementById(ct);if(b$.Equals(cv,null))ce.FailWith("invalid id: "+ct);else bG.RunBefore(cv,cu);};bG.RunBefore=function(ct,cu){var cv;cv=self.document.createTextNode("");ct.parentNode.insertBefore(cv,ct);bG.RunBetween(cv,ct,cu);};bG.RunBetween=function(ct,cu,cv){var cw;bF.LinkPrevElement(cu,cv.docNode);cw=bF.CreateDelimitedRunState(ct,cu,cv.docNode);y.Sink(T.get_UseAnimations()||bz.BatchUpdatesEnabled()?n.StartProcessor(bF.PerformAnimatedUpdate(false,cw,cv.docNode)):function(){bF.PerformSyncUpdate(false,cw,cv.docNode);},cv.updates);};bG.Async=function(ct){return bG.EmbedView(y.MapAsync(a.id,y.Const(ct)));};bG.BindView=function(ct,cu){return bG.EmbedView(y.Map(ct,cu));};bG.EmbedView=function(ct){var cu;cu=bF.CreateEmbedNode();return bG.Mk({$:2,$0:cu},y.Map(a.ignore,y.Bind(function(cv){bF.UpdateEmbedNode(cu,cv.docNode);return cv.updates;},ct)));};bG.Verbatim=function(ct){return bG.Mk(d.MapTreeReduce(function(cu){return b$.Equals(cu.nodeType,cm.TEXT_NODE)?{$:5,$0:cu}:{$:1,$0:bF.CreateElemNode(cu,_6.EmptyAttr(),null)};},null,function(cu,cv){return{$:0,$0:cu,$1:cv};},r.ChildrenArray(r.ParseHTMLIntoFakeRoot(ct))),y.Const());};bG.StaticProxy=function(ct){return bH.New(ct,_6.EmptyAttr(),bG.get_Empty());};bG.TextNode=function(ct){return bG.Mk({$:5,$0:self.document.createTextNode(ct)},y.Const());};bG.get_Empty=function(){return bG.Mk(null,y.Const());};bG.Concat=function(ct){var cu;cu=d.ofSeqNonCopying(ct);return d.TreeReduce(bG.get_Empty(),bG.Append,cu);};bG.Append=function(ct,cu){return bG.Mk({$:0,$0:ct.docNode,$1:cu.docNode},y.Map2Unit(ct.updates,cu.updates));};bG.Mk=function(ct,cu){return new bG.New(ct,cu);};bG.New=b_.Ctor(function(ct,cu){k.New.call(this);this.docNode=ct;this.updates=cu;},bG);bH=c.Elt=b_.Class({SetStyle:function(ct,cu){this.elt.style[ct]=cu;},HasClass:function(ct){return(new a.RegExp("(\\s|^)"+ct+"(\\s|$)")).test(this.elt.className);},GetProperty:function(ct){return this.elt[ct];},SetProperty:function(ct,cu){this.elt[ct]=cu;},RemoveAttribute:function(ct){this.elt.removeAttribute(ct);},HasAttribute:function(ct){return this.elt.hasAttribute(ct);},GetAttribute:function(ct){return this.elt.getAttribute(ct);},SetAttribute:function(ct,cu){this.elt.setAttribute(ct,cu);},SetText:function(ct){var cu;cu=this.docNode$1;if(cu!=null&&cu.$==1)cu.$0.Children=null;else cu!=null&&cu.$==6?(cu.$0.Els=[],this.ClearHoles()):ce.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());this.elt.textContent=ct;},GetText:function(){return this.elt.textContent;},SetValue:function(ct){this.elt.value=ct;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var ct;ct=this.docNode$1;if(ct!=null&&ct.$==1)ct.$0.Children=null;else ct!=null&&ct.$==6?(ct.$0.Els=[],this.ClearHoles()):ce.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(ct){var cu,cv,cw,cx,cy;cu=this.docNode$1;if(cu!=null&&cu.$==1){cv=cu.$0;cv.Children={$:0,$0:ct.docNode,$1:cv.Children};bF.InsertDoc(this.elt,ct.docNode,(cw=this.elt.firstChild,b$.Equals(cw,null)?null:cw));}else cu!=null&&cu.$==6?(cx=this.elt.insertBefore(self.document.createTextNode(""),this.elt.firstChild),cy=bF.InsertBeforeDelim(cx,ct.docNode),this.AddHole(bA.New(_6.Empty(this.elt),ct.docNode,{$:1,$0:[cy,cx]},this.elt,h.Int(),null))):ce.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,ct.updates));},Append:function(ct){var cu,cv,cw,cx;cu=this.docNode$1;if(cu!=null&&cu.$==1){cv=cu.$0;cv.Children={$:0,$0:cv.Children,$1:ct.docNode};bF.InsertDoc(this.elt,ct.docNode,null);}else cu!=null&&cu.$==6?(cw=this.elt.appendChild(self.document.createTextNode("")),cx=bF.InsertBeforeDelim(cw,ct.docNode),this.AddHole(bA.New(_6.Empty(this.elt),ct.docNode,{$:1,$0:[cx,cw]},this.elt,h.Int(),null))):ce.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,ct.updates));},ToUpdater:function(){var ct,cu,cv;return new bI.New((ct=this.docNode$1,ct!=null&&ct.$==1?b_.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,ct.$0.Attr]],Render:(cu=null,cu?cu.$0:void 0),El:(cv={$:1,$0:this.elt},cv?cv.$0:void 0)},["Render","El"]):ct!=null&&ct.$==6?ct.$0:ce.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,A.Create$1([]));},OnAfterRenderView:function(ct,cu){var cv,cw;cv=this;cw=h.Id();this.Append(bG.BindView(function(cx){cv.elt[cw]=cx;return bG.get_Empty();},ct));return this["OnAfterRender'"](function(cx){cu(cx,cx[cw]);});},OnAfterRender:function(ct){return this["OnAfterRender'"](ct);},"OnAfterRender'":function(ct){var cu,cv,cw,cx,cy,cz,cA;cu=this.docNode$1;if(cu!=null&&cu.$==1){cv=cu.$0;b_.SetOptional(cv,"Render",(cw=b_.GetOptional(cv.Render),cw!=null&&cw.$==1?(cx=cw.$0,{$:1,$0:function(cB){cx(cB);ct(cB);}}):{$:1,$0:ct}));}else cu!=null&&cu.$==6?(cy=cu.$0,b_.SetOptional(cy,"Render",(cz=b_.GetOptional(cy.Render),cz!=null&&cz.$==1?(cA=cz.$0,{$:1,$0:function(cB){cA(cB);ct(cB);}}):{$:1,$0:ct}))):ce.FailWith("Invalid docNode in Elt");return this;},onView:function(ct,cu,cv){var cw;cw=cv(this.elt);this.elt.addEventListener(ct,function(cx){return y.Get(cw(cx),cu);},false);return this;},on:function(ct,cu){var cv;cv=this;this.elt.addEventListener(ct,function(cw){return cu(cv.elt,cw);},false);return this;},ClearHoles:function(){var ct;ct=this.docNode$1;if(ct!=null&&ct.$==6)ct.$0.Holes=[];},AddHole:function(ct){var cu;cu=this.docNode$1;if(cu!=null&&cu.$==6)cu.$0.Holes.push(ct);}},bG,bH);bH.TreeNode=function(ct,cu){var cv,cw;function cx(cy,cz){return _6.Updates(cz);}cv=B.Create(cu);return new bH.New$1({$:6,$0:ct},y.Map2Unit((cw=b3.map(function(cy){return cx(cy[0],cy[1]);},ct.Attrs),d.TreeReduce(y.Const(),y.Map2Unit,cw)),cv.v),b3.get(ct.Els,0),cv);};bH.New=function(ct,cu,cv){var cw,cx;cw=bF.CreateElemNode(ct,cu,cv.docNode);cx=B.Create(cv.updates);return new bH.New$1({$:1,$0:cw},y.Map2Unit(_6.Updates(cw.Attr),cx.v),ct,cx);};bH.New$1=b_.Ctor(function(ct,cu,cv,cw){bG.New.call(this,ct,cu);this.docNode$1=ct;this.updates$1=cu;this.elt=cv;this.rvUpdates=cw;},bH);bI=_3.EltUpdater=b_.Class({ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];this.holeUpdates.Set([]);},AddHole:function(ct){this.origHoles.push(ct);this.treeNode.Holes=this.treeNode.Holes.concat([ct]);},RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;this.holeUpdates.Set([]);},RemoveUpdated:function(ct){var cu,cv;function cw(cx){return cx!==cv;}cu=ct.docNode;if(cu!=null&&cu.$==1){cv=cu.$0.ElKey;this.treeNode.Holes=b3.filter(function(cx){return cx.ElKey!==cv;},this.treeNode.Holes);this.holeUpdates.Set(b3.filter(function(cx){return cw(cx[0]);},this.holeUpdates.Get()));}else ce.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(ct){var cu,cv,cw;cu=ct.docNode;if(cu!=null&&cu.$==1){cv=cu.$0;this.treeNode.Holes=this.treeNode.Holes.concat([cv]);cw=this.holeUpdates.Get();cw.push([cv.ElKey,ct.updates]);this.holeUpdates.Set(cw);}else ce.FailWith("DocUpdater.AddUpdated expects a single element node");}},bH,bI);bI.New=b_.Ctor(function(ct,cu,cv,cw,cx){var cy,cz,cA,cB;function cC(cD){return cD[1];}bH.New$1.call(this,{$:6,$0:ct},y.Map2Unit(cu,(cy=cx.get_View(),y.BindInner((cz=function(cD){return b3.map(cC,cD);},(cA=(cB=y.Const(),function(cD){return d.TreeReduce(cB,y.Map2Unit,cD);}),function(cD){return cA(cz(cD));})),cy))),cv,cw);this.treeNode=ct;this.holeUpdates=cx;this.origHoles=this.treeNode.Holes;},bI);bJ.$cctor=function(){bJ.$cctor=a.ignore;bJ.BatchUpdatesEnabled=true;};bL.failNotLoaded=function(ct){ca.warn("Instantiating non-loaded template",ct);};bL.fill=function(ct,cu,cv){while(true)if(ct.hasChildNodes())cv=cu.insertBefore(ct.lastChild,cv);else return null;};bL.fillTextHole=function(ct,cu,cv){var cw;cw=ct.querySelector("[ws-replace]");return b$.Equals(cw,null)?(ca.warn("Filling non-existent text hole",cv),null):(cw.parentNode.replaceChild(self.document.createTextNode(cu),cw),{$:1,$0:cw.getAttribute("ws-replace")});};bL.removeHolesExcept=function(ct,cu){function cv(cw){bK.foreachNotPreserved(ct,"["+cw+"]",function(cx){if(!cu.Contains(cx.getAttribute(cw)))cx.removeAttribute(cw);});}cv("ws-attr");cv("ws-onafterrender");cv("ws-var");bK.foreachNotPreserved(ct,"[ws-hole]",function(cw){if(!cu.Contains(cw.getAttribute("ws-hole"))){cw.removeAttribute("ws-hole");while(cw.hasChildNodes())cw.removeChild(cw.lastChild);}});bK.foreachNotPreserved(ct,"[ws-replace]",function(cw){if(!cu.Contains(cw.getAttribute("ws-replace")))cw.parentNode.removeChild(cw);});bK.foreachNotPreserved(ct,"[ws-on]",function(cw){cw.setAttribute("ws-on",b5.concat(" ",b3.filter(function(cx){return cu.Contains(b3.get(b5.SplitChars(cx,[":"],1),1));},b5.SplitChars(cw.getAttribute("ws-on"),[" "],1))));});bK.foreachNotPreserved(ct,"[ws-attr-holes]",function(cw){var cx,cy,cz,cA,cB;cx=b5.SplitChars(cw.getAttribute("ws-attr-holes"),[" "],1);for(cy=0,cz=cx.length-1;cy<=cz;cy++){cA=b3.get(cx,cy);cw.setAttribute(cA,(cB=new a.RegExp(bK.TextHoleRE(),"g"),cw.getAttribute(cA).replace(cB,function(cC,cD){return cu.Contains(cD)?cC:"";})));}});};bL.fillInstanceAttrs=function(ct,cu){var cv,cw,cx,cy,cz;bL.convertAttrs(cu);cv=cu.nodeName.toLowerCase();cw=ct.querySelector("[ws-attr="+cv+"]");if(b$.Equals(cw,null))ca.warn("Filling non-existent attr hole",cv);else{cw.removeAttribute("ws-attr");for(cx=0,cy=cu.attributes.length-1;cx<=cy;cx++){cz=cu.attributes.item(cx);if(cz.name=="class"&&cw.hasAttribute("class"))cw.setAttribute("class",cw.getAttribute("class")+" "+cz.nodeValue);else cw.setAttribute(cz.name,cz.nodeValue);}}};bL.mapHoles=function(ct,cu){function cv(cw){bK.foreachNotPreserved(ct,"["+cw+"]",function(cx){var cy,cz;cy=(cz=null,[cu.TryGetValue(cx.getAttribute(cw).toLowerCase(),{get:function(){return cz;},set:function(cA){cz=cA;}}),cz]);if(cy[0])cx.setAttribute(cw,cy[1]);});}cv("ws-hole");cv("ws-replace");cv("ws-attr");cv("ws-onafterrender");cv("ws-var");bK.foreachNotPreserved(ct,"[ws-on]",function(cw){cw.setAttribute("ws-on",b5.concat(" ",b3.map(function(cx){var cy,cz,cA;cy=b5.SplitChars(cx,[":"],1);cz=(cA=null,[cu.TryGetValue(b3.get(cy,1),{get:function(){return cA;},set:function(cB){cA=cB;}}),cA]);return cz[0]?b3.get(cy,0)+":"+cz[1]:cx;},b5.SplitChars(cw.getAttribute("ws-on"),[" "],1))));});bK.foreachNotPreserved(ct,"[ws-attr-holes]",function(cw){var cx,cy,cz;cx=b5.SplitChars(cw.getAttribute("ws-attr-holes"),[" "],1);for(cy=0,cz=cx.length-1;cy<=cz;cy++)(function(){var cA;function cB(cC,cD){var cE;cE=ce.KeyValue(cD);return cC.replace(new a.RegExp("\\${"+cE[0]+"}","ig"),"${"+cE[1]+"}");}cA=b3.get(cx,cy);return cw.setAttribute(cA,(((b_.Curried3(b9.fold))(cB))(cw.getAttribute(cA)))(cu));}());});};bL.convertTextNode=function(ct){var cu,cv,cw,cx,cy,cz;cu=null;cv=0;cx=ct.textContent;cy=new a.RegExp(bK.TextHoleRE(),"g");while(cu=cy.exec(cx),cu!==null){ct.parentNode.insertBefore(self.document.createTextNode(cn.string(cx,{$:1,$0:cv},{$:1,$0:cy.lastIndex-b3.get(cu,0).length-1})),ct);cv=cy.lastIndex;cz=self.document.createElement("span");cz.setAttribute("ws-replace",b3.get(cu,1).toLowerCase());ct.parentNode.insertBefore(cz,ct);}cy.lastIndex=0;ct.textContent=cn.string(cx,{$:1,$0:cv},null);};bL.convertAttrs=function(ct){var cv,cw,cx,cy,cz,cA,cB,cC;function cu(cD){var cE;cE=ct.getAttribute(cD);if(cE==null);else ct.setAttribute(cD,cE.toLowerCase());}cv=ct.attributes;cw=[];cx=[];cy=[];for(cz=0,cA=cv.length-1;cz<=cA;cz++){cB=cv.item(cz);if(b5.StartsWith(cB.nodeName,"ws-on")&&cB.nodeName!="ws-onafterrender"&&cB.nodeName!="ws-on"){cw.push(cB.nodeName);cx.push(cn.string(cB.nodeName,{$:1,$0:"ws-on".length},null)+":"+cB.nodeValue.toLowerCase());}else!b5.StartsWith(cB.nodeName,"ws-")&&(new a.RegExp(bK.TextHoleRE())).test(cB.nodeValue)?(cB.nodeValue=(cC=new a.RegExp(bK.TextHoleRE(),"g"),cB.nodeValue.replace(cC,function(cD,cE){return"${"+cE.toLowerCase()+"}";})),cy.push(cB.nodeName)):void 0;}if(!(cx.length==0))ct.setAttribute("ws-on",b5.concat(" ",cx));if(!(cy.length==0))ct.setAttribute("ws-attr-holes",b5.concat(" ",cy));cu("ws-hole");cu("ws-replace");cu("ws-attr");cu("ws-onafterrender");cu("ws-var");b3.iter(function(cD){ct.removeAttribute(cD);},cw);};bK.GetOrLoadTemplate=function(ct,cu,cv,cw){bK.LoadLocalTemplates("");bK.PrepareTemplate(ct,cu,cv);return bK.NamedTemplate(ct,cu,cw);};bK.NamedTemplate=function(ct,cu,cv){var cw,cx;cw=(cx=null,[bK.LoadedTemplateFile(ct).TryGetValue(cu==null?"":cu.$0,{get:function(){return cx;},set:function(cy){cx=cy;}}),cx]);return cw[0]?bK.ChildrenTemplate(cw[1].cloneNode(true),cv):(ca.warn("Local template doesn't exist",cu),bG.get_Empty());};bK.RunFullDocTemplate=function(ct){var cu,cv,cw;return bK.RenderedFullDocTemplate()==null?(cu=(bK.LoadLocalTemplates(""),bK.PrepareTemplateStrict("",null,self.document.body,null),cv=bK.ChildrenTemplate(self.document.body,ct),cw=self.document.body,function(cx){bG.RunInPlace(true,cw,cx);}(cv),cv),(bK.set_RenderedFullDocTemplate({$:1,$0:cu}),cu)):bK.RenderedFullDocTemplate().$0;};bK.RenderedFullDocTemplate=function(){bM.$cctor();return bM.RenderedFullDocTemplate;};bK.set_RenderedFullDocTemplate=function(ct){bM.$cctor();bM.RenderedFullDocTemplate=ct;};bK.LoadLocalTemplates=function(ct){!bK.LocalTemplatesLoaded()?(bK.set_LocalTemplatesLoaded(true),bK.LoadNestedTemplates(self.document.body,"")):void 0;bK.LoadedTemplates().set_Item(ct,bK.LoadedTemplateFile(""));};bK.LoadNestedTemplates=function(ct,cu){var cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ;function cv(cR){var cS,cT;if(!cw.ContainsKey(cR)){cS=(cT=null,[cx.TryGetValue(cR,{get:function(){return cT;},set:function(cU){cT=cU;}}),cT]);if(cS[0]){cQ.SAdd(cR);cx.RemoveKey(cR);bK.PrepareTemplateStrict(cu,{$:1,$0:cR},cS[1],{$:1,$0:cv});}else ca.warn(cQ.Contains(cR)?"Encountered loop when instantiating "+cR:"Local template does not exist: "+cR);}}cw=bK.LoadedTemplateFile(cu);cx=new ch.New$5();cy=ct.querySelectorAll("[ws-template]");for(cz=0,cA=cy.length-1;cz<=cA;cz++){cB=cy[cz];cC=cB.getAttribute("ws-template").toLowerCase();cB.removeAttribute("ws-template");cx.set_Item(cC,bK.FakeRootSingle(cB));}cD=ct.querySelectorAll("[ws-children-template]");for(cE=0,cF=cD.length-1;cE<=cF;cE++){cG=cD[cE];cH=cG.getAttribute("ws-children-template").toLowerCase();cG.removeAttribute("ws-children-template");cx.set_Item(cH,bK.FakeRoot(cG));}cI=ct.querySelectorAll("template[id]");for(cJ=0,cK=cI.length-1;cJ<=cK;cJ++){cL=cI[cJ];cx.set_Item(cL.getAttribute("id").toLowerCase(),bK.FakeRootFromHTMLTemplate(cL));}cM=ct.querySelectorAll("template[name]");for(cN=0,cO=cM.length-1;cN<=cO;cN++){cP=cM[cN];cx.set_Item(cP.getAttribute("name").toLowerCase(),bK.FakeRootFromHTMLTemplate(cP));}cQ=new b8.New$3();while(cx.count>0)cv(b9.head(cx.Keys()));};bK.PrepareTemplate=function(ct,cu,cv){if(!bK.LoadedTemplateFile(ct).ContainsKey(cu==null?"":cu.$0))bK.PrepareTemplateStrict(ct,cu,cv(),null);};bK.PrepareSingleTemplate=function(ct,cu,cv){var cw;cw=bK.FakeRootSingle(cv);return function(cx){bK.PrepareTemplateStrict(ct,cu,cw,cx);};};bK.PrepareTemplateStrict=function(ct,cu,cv,cw){var cx,cy;function cz(cF,cG){var cH,cI,cJ,cK,cL,cN,cO,cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c0,c1,c2,c3,c4,c5,c6,c7;function cM(c8){}while(true)switch(cF){case 0:if(cG!==null){cH=cG.nextSibling;if(b$.Equals(cG.nodeType,cm.TEXT_NODE))bL.convertTextNode(cG);else if(b$.Equals(cG.nodeType,cm.ELEMENT_NODE))cB(cG);cG=cH;}else return null;break;case 1:cN=cn.string(cG.nodeName,{$:1,$0:3},null).toLowerCase();cO=(cI=cN.indexOf("."),cI===-1?[ct,cN]:[cn.string(cN,null,{$:1,$0:cI-1}),cn.string(cN,{$:1,$0:cI+1},null)]);cP=cO[1];cQ=cO[0];if(cQ!=""&&!bK.LoadedTemplates().ContainsKey(cQ))return bL.failNotLoaded(cP);else{if(cQ==""&&cw!=null)cw.$0(cP);cR=bK.LoadedTemplates().Item(cQ);if(!cR.ContainsKey(cP))return bL.failNotLoaded(cP);else{cS=cR.Item(cP);cT=cS.cloneNode(true);cU=new b8.New$3();cV=new ch.New$5();cW=cG.attributes;for(cX=0,cY=cW.length-1;cX<=cY;cX++){cZ=cW.item(cX).name.toLowerCase();cV.set_Item(cZ,(c0=cW.item(cX).nodeValue,c0==""?cZ:c0.toLowerCase()));if(!cU.SAdd(cZ))ca.warn("Hole mapped twice",cZ);}for(c1=0,c2=cG.childNodes.length-1;c1<=c2;c1++){c3=cG.childNodes[c1];if(b$.Equals(c3.nodeType,cm.ELEMENT_NODE))!cU.SAdd(c3.nodeName.toLowerCase())?ca.warn("Hole filled twice",cP):void 0;}c4=cG.childNodes.length===1&&b$.Equals(cG.firstChild.nodeType,cm.TEXT_NODE);if(c4){cK=bL.fillTextHole(cT,cG.firstChild.textContent,cP);((function(c8){return function(c9){if(c9!=null)c8(c9.$0);};}((cL=function(c8){return function(c9){return c8.SAdd(c9);};}(cU),function(c8){return cM(cL(c8));})))(cK));}bL.removeHolesExcept(cT,cU);if(!c4){for(c5=0,c6=cG.childNodes.length-1;c5<=c6;c5++){c7=cG.childNodes[c5];if(b$.Equals(c7.nodeType,cm.ELEMENT_NODE))c7.hasAttributes()?bL.fillInstanceAttrs(cT,c7):cA(cT,c7);}}bL.mapHoles(cT,cV);bL.fill(cT,cG.parentNode,cG);cG.parentNode.removeChild(cG);return;}}break;}}function cA(cF,cG){var cH,cI,cK,cL;function cJ(cM,cN){var cO;if(cK=="title"&&cG.hasChildNodes()){cO=r.ParseHTMLIntoFakeRoot(cG.textContent);cG.removeChild(cG.firstChild);while(cO.hasChildNodes())cG.appendChild(cO.firstChild);}else null;cB(cG);return bL.fill(cG,cM,cN);}cK=cG.nodeName.toLowerCase();bK.foreachNotPreserved(cF,"[ws-attr-holes]",function(cM){var cN,cO,cP,cQ,cR;cN=b5.SplitChars(cM.getAttribute("ws-attr-holes"),[" "],1);for(cO=0,cP=cN.length-1;cO<=cP;cO++){cQ=b3.get(cN,cO);cM.setAttribute(cQ,(cR=new a.RegExp("\\${"+cK+"}","ig"),cM.getAttribute(cQ).replace(cR,cG.textContent)));}});cL=cF.querySelector("[ws-hole="+cK+"]");if(b$.Equals(cL,null)){cH=cF.querySelector("[ws-replace="+cK+"]");return b$.Equals(cH,null)?(cI=cF.querySelector("slot[name="+cK+"]"),cF.tagName.toLowerCase()=="template"?(cJ(cI.parentNode,cI),void cI.parentNode.removeChild(cI)):null):(cJ(cH.parentNode,cH),void cH.parentNode.removeChild(cH));}else{while(cL.hasChildNodes())cL.removeChild(cL.lastChild);cL.removeAttribute("ws-hole");return cJ(cL,null);}}function cB(cF){if(!cF.hasAttribute("ws-preserve"))if(b5.StartsWith(cF.nodeName.toLowerCase(),"ws-"))cD(cF);else{bL.convertAttrs(cF);cC(cF.firstChild);}}function cC(cF){return cz(0,cF);}function cD(cF){return cz(1,cF);}function cE(cF){var cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR;while(true){cG=cF.querySelector("[ws-template]");if(b$.Equals(cG,null)){cH=cF.querySelector("[ws-children-template]");if(b$.Equals(cH,null)){cI=cF.querySelectorAll("template[id]");for(cJ=1,cK=cI.length-1;cJ<=cK;cJ++){cL=cI[cJ];if(cx.Contains(cL));else{bK.PrepareTemplateStrict(ct,{$:1,$0:cL.getAttribute("id")},cL,null);cx.SAdd(cL);}}cM=cF.querySelectorAll("template[name]");for(cN=1,cO=cM.length-1;cN<=cO;cN++){cP=cM[cN];if(cx.Contains(cP));else{bK.PrepareTemplateStrict(ct,{$:1,$0:cP.getAttribute("name")},cP,null);cx.SAdd(cP);}}return null;}else{cQ=cH.getAttribute("ws-children-template");cH.removeAttribute("ws-children-template");bK.PrepareTemplateStrict(ct,{$:1,$0:cQ},cH,null);cF=cF;}}else{cR=cG.getAttribute("ws-template");(bK.PrepareSingleTemplate(ct,{$:1,$0:cR},cG))(null);cF=cF;}}}cx=new b8.New$3();cy=(cu==null?"":cu.$0).toLowerCase();bK.LoadedTemplateFile(ct).set_Item(cy,cv);if(cv.hasChildNodes()){cE(cv);cC(cv.firstChild);}};bK.FakeRootSingle=function(ct){var cu,cv,cw,cx;ct.removeAttribute("ws-template");cu=ct.getAttribute("ws-replace");if(cu==null);else{ct.removeAttribute("ws-replace");cv=ct.parentNode;b$.Equals(cv,null)?void 0:(cw=self.document.createElement(ct.tagName),cw.setAttribute("ws-replace",cu),cv.replaceChild(cw,ct));}cx=self.document.createElement("div");cx.appendChild(ct);return cx;};bK.FakeRootFromHTMLTemplate=function(ct){var cu,cv,cw,cx;cu=self.document.createElement("div");cv=ct.content;for(cw=0,cx=cv.childNodes.length-1;cw<=cx;cw++)cu.appendChild(cv.childNodes[cw].cloneNode(true));return cu;};bK.FakeRoot=function(ct){var cu;cu=self.document.createElement("div");while(ct.hasChildNodes())cu.appendChild(ct.firstChild);return cu;};bK.ChildrenTemplate=function(ct,cu){var cv,cw,cx,cy,cz;cv=bK.InlineTemplate(ct,b9.append(cu,bK.GlobalHoles().Values()));cw=cv[1];cx=cv[0];cy=cx.Els;return!b$.Equals(cy,null)&&cy.length===1&&(b3.get(cy,0)instanceof cm&&(b$.Equals(b3.get(cy,0).nodeType,cm.ELEMENT_NODE)&&(cz=b3.get(cy,0),true)))?bH.TreeNode(cx,cw):bG.Mk({$:6,$0:cx},cw);};bK.InlineTemplate=function(ct,cu){var cv,cw,cx,cy,cz,cD,cE,cF,cG,cH,cI,cJ;function cA(cK,cL){var cM,cN,cO;cM=_6.Insert(cK,cL);cE.push(_6.Updates(cM));cF.push([cK,cM]);cN=b_.GetOptional(cM.OnAfterRender);return cN==null?null:(cO=cN.$0,void cG.push(function(){cO(cK);}));}function cB(cK){var cL,cM,cN,cO;cL=(cM=null,[cH.TryGetValue(cK,{get:function(){return cM;},set:function(cP){cM=cP;}}),cM]);return cL[0]?(cN=cL[1],cN instanceof bb?{$:1,$0:cN.get_Value()}:cN instanceof bc?{$:1,$0:bG.TextNode(cN.get_Value())}:(cO=cN.ForTextView(),cO==null?null:{$:1,$0:bG.TextView(cO.$0)})):null;}function cC(){bK.foreachNotPreservedwsDOM("[ws-dom]",function(cK){var cL,cM,cN,cO,cP,cQ,cR;cL=(cM=null,[cH.TryGetValue(cK.getAttribute("ws-dom").toLowerCase(),{get:function(){return cM;},set:function(cS){cM=cS;}}),cM]);if(cL[0]){cN=cL[1];cN instanceof bp?(cO=cN.get_Value(),cK.removeAttribute("ws-dom"),cP=cK,cQ=new a.MutationObserver(function(cS,cT){b3.iter(function(cU){function cV(cW,cX,cY,cZ){if(cW===cP&&cU.addedNodes.length!==1){cO.SetFinal(null);cT.disconnect();}}cU.removedNodes.forEach(b_.CreateFuncWithArgs(function(cW){return cV(cW[0],cW[1],cW[2],cW[3]);}),null);},cS);}),cK.parentElement!==null?cQ.observe(cK.parentElement,(cR={},cR.childList=true,cR)):void 0,cO.Set({$:1,$0:cK}),y.Sink(function(cS){var cT;if(cS!=null&&cS.$==1){cT=cS.$0;if(cP===cT);else{cP.replaceWith.apply(cP,[cT]);cP=cT;}}else{cP.remove();cQ.disconnect();}},cO.get_View())):void 0;}});}cD=[];cE=[];cF=[];cG=[];cH=new ch.New$5();cI=b4.Get(cu);try{while(cI.MoveNext()){cJ=cI.Current();cH.set_Item(cJ.get_Name(),cJ);}}finally{if(typeof cI=="object"&&"Dispose"in cI)cI.Dispose();}cv=r.ChildrenArray(ct);bK.foreachNotPreserved(ct,"[ws-hole]",function(cK){var cL,cM,cN;cN=cK.getAttribute("ws-hole");cK.removeAttribute("ws-hole");while(cK.hasChildNodes())cK.removeChild(cK.lastChild);cL=cB(cN);if(cL!=null&&cL.$==1){cM=cL.$0;bF.LinkElement(cK,cM.docNode);cD.push(bA.New(_6.Empty(cK),cM.docNode,null,cK,h.Int(),null));cE.push(cM.updates);}});bK.foreachNotPreserved(ct,"[ws-replace]",function(cK){var cL,cM,cN,cO,cP,cQ;cL=cB(cK.getAttribute("ws-replace"));if(cL!=null&&cL.$==1){cM=cL.$0;cN=cK.parentNode;cO=self.document.createTextNode("");cN.replaceChild(cO,cK);cP=bF.InsertBeforeDelim(cO,cM.docNode);cQ=b3.tryFindIndex(function(cR){return cK===cR;},cv);cQ==null?void 0:b3.set(cv,cQ.$0,cM.docNode);cD.push(bA.New(_6.Empty(cN),cM.docNode,{$:1,$0:[cP,cO]},cN,h.Int(),null));cE.push(cM.updates);}});cw=false;bK.foreachNotPreserved(ct,"slot",function(cK){var cL,cM,cN,cO;cN=cK.getAttribute("name");cO=cN==""||cN==null?"default":cN.toLowerCase();if(cw&&cO=="default"||!b$.Equals(ct.parentElement,null))void 0;else{while(cK.hasChildNodes())cK.removeChild(cK.lastChild);if(cO=="default")cw=true;cL=cB(cO);if(cL!=null&&cL.$==1){cM=cL.$0;bF.LinkElement(cK,cM.docNode);cD.push(bA.New(_6.Empty(cK),cM.docNode,null,cK,h.Int(),null));cE.push(cM.updates);}}});bK.foreachNotPreserved(ct,"[ws-attr]",function(cK){var cL,cM,cN,cO;cL=cK.getAttribute("ws-attr");cK.removeAttribute("ws-attr");cM=(cN=null,[cH.TryGetValue(cL,{get:function(){return cN;},set:function(cP){cN=cP;}}),cN]);if(cM[0]){cO=cM[1];cO instanceof be?cA(cK,cO.get_Value()):ca.warn("Attribute hole filled with non-attribute data",cL);}});bK.foreachNotPreserved(ct,"[ws-on]",function(cK){cA(cK,_2.Concat(b3.choose(function(cL){var cM,cN,cO,cP;cM=b5.SplitChars(cL,[":"],1);cN=(cO=null,[cH.TryGetValue(b3.get(cM,1),{get:function(){return cO;},set:function(cQ){cO=cQ;}}),cO]);return cN[0]?(cP=cN[1],cP instanceof bf?{$:1,$0:_9.Handler(b3.get(cM,0),cP.get_Value())}:cP instanceof bg?{$:1,$0:_2.Handler(b3.get(cM,0),cP.get_Value())}:(ca.warn("Event hole on"+b3.get(cM,0)+" filled with non-event data",b3.get(cM,1)),null)):null;},b5.SplitChars(cK.getAttribute("ws-on"),[" "],1))));cK.removeAttribute("ws-on");});bK.foreachNotPreserved(ct,"[ws-onafterrender]",function(cK){var cL,cM,cN,cO;cL=cK.getAttribute("ws-onafterrender");cM=(cN=null,[cH.TryGetValue(cL,{get:function(){return cN;},set:function(cP){cN=cP;}}),cN]);if(cM[0]){cO=cM[1];cO instanceof bi?(cK.removeAttribute("ws-onafterrender"),cA(cK,_9.OnAfterRender(cO.get_Value()))):cO instanceof bj?(cK.removeAttribute("ws-onafterrender"),cA(cK,_9.OnAfterRender(cO.get_Value()))):ca.warn("onafterrender hole filled with non-onafterrender data",cL);}});bK.foreachNotPreserved(ct,"[ws-var]",function(cK){var cL,cM,cN;cL=cK.getAttribute("ws-var");cK.removeAttribute("ws-var");cM=(cN=null,[cH.TryGetValue(cL,{get:function(){return cN;},set:function(cO){cN=cO;}}),cN]);if(cM[0])cM[1].AddAttribute(function(cO){return function(cP){return cA(cO,cP);};},cK);});bK.foreachNotPreserved(ct,"[ws-attr-holes]",function(cK){var cL,cM,cN,cO;cL=new a.RegExp(bK.TextHoleRE(),"g");cM=b5.SplitChars(cK.getAttribute("ws-attr-holes"),[" "],1);cK.removeAttribute("ws-attr-holes");for(cN=0,cO=cM.length-1;cN<=cO;cN++)(function(){var cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c0,c1;cY=b3.get(cM,cN);cZ=cK.getAttribute(cY);cP=null;cQ=0;c0=[];while(cP=cL.exec(cZ),cP!==null){c1=cn.string(cZ,{$:1,$0:cQ},{$:1,$0:cL.lastIndex-b3.get(cP,0).length-1});cQ=cL.lastIndex;c0.push([c1,b3.get(cP,1)]);}cS=cn.string(cZ,{$:1,$0:cQ},null);cL.lastIndex=0;cT=b3.foldBack(function(c2,c3){return(function(c4){var c5,c6;c5=c4[0];c6=c4[1];return function(c7){var c8,c9,c_,c$,da;c8=c7[0];c9=c7[1];c_=(c$=(da=null,[cH.TryGetValue(c6,{get:function(){return da;},set:function(db){da=db;}}),da]),c$[0]?c$[1].get_AsChoiceView():{$:0,$0:""});return c_.$==1?[c5,new b2.T({$:1,$0:c8==""?c_.$0:y.Map(function(db){return db+c8;},c_.$0),$1:c9})]:[c5+c_.$0+c8,c9];};}(c2))(c3);},c0,[cS,b2.T.Empty]);return cA(cK,cT[1].$==1?cT[1].$1.$==1?cT[1].$1.$1.$==1?cT[1].$1.$1.$1.$==0?(cU=cT[0],_9.Dynamic(cY,y.Map3(function(c2,c3,c4){return cU+c2+c3+c4;},cT[1].$0,cT[1].$1.$0,cT[1].$1.$1.$0))):(cV=cT[0],_9.Dynamic(cY,y.Map(function(c2){return cV+b5.concat("",c2);},y.Sequence(cT[1])))):(cW=cT[0],_9.Dynamic(cY,y.Map2(function(c2,c3){return cW+c2+c3;},cT[1].$0,cT[1].$1.$0))):cT[0]==""?_9.Dynamic(cY,cT[1].$0):(cX=cT[0],_9.Dynamic(cY,y.Map(function(c2){return cX+c2;},cT[1].$0))):_2.Create(cY,cT[0]));}());});return[b_.DeleteEmptyFields({Els:cv,Dirty:true,Holes:cD,Attrs:cF,Render:(cx=cG.length==0?{$:1,$0:function(){cC();}}:{$:1,$0:function(cK){cC();b3.iter(function(cL){cL(cK);},cG);}},cx?cx.$0:void 0),El:(cy=!b$.Equals(cv,null)&&cv.length===1&&(b3.get(cv,0)instanceof cm&&(b3.get(cv,0)instanceof a.Element&&(cz=b3.get(cv,0),true)))?{$:1,$0:cz}:null,cy?cy.$0:void 0)},["Render","El"]),d.TreeReduce(y.Const(),y.Map2Unit,cE)];};bK.foreachNotPreservedwsDOM=function(ct,cu){r.IterSelectorDoc(ct,function(cv){if(cv.closest("[ws-preserve]")==null)cu(cv);});};bK.foreachNotPreserved=function(ct,cu,cv){r.IterSelector(ct,cu,function(cw){if(cw.closest("[ws-preserve]")==null)cv(cw);});};bK.TextHoleRE=function(){bM.$cctor();return bM.TextHoleRE;};bK.GlobalHoles=function(){bM.$cctor();return bM.GlobalHoles;};bK.set_GlobalHoles=function(ct){bM.$cctor();bM.GlobalHoles=ct;};bK.LocalTemplatesLoaded=function(){bM.$cctor();return bM.LocalTemplatesLoaded;};bK.set_LocalTemplatesLoaded=function(ct){bM.$cctor();bM.LocalTemplatesLoaded=ct;};bK.LoadedTemplateFile=function(ct){var cu,cv,cw;cu=(cv=null,[bK.LoadedTemplates().TryGetValue(ct,{get:function(){return cv;},set:function(cx){cv=cx;}}),cv]);return cu[0]?cu[1]:(cw=new ch.New$5(),(bK.LoadedTemplates().set_Item(ct,cw),cw));};bK.LoadedTemplates=function(){bM.$cctor();return bM.LoadedTemplates;};bM.$cctor=function(){bM.$cctor=a.ignore;bM.LoadedTemplates=new ch.New$5();bM.LocalTemplatesLoaded=false;bM.GlobalHoles=new ch.New$5();bM.TextHoleRE="\\${([^}]+)}";bM.RenderedFullDocTemplate=null;};bN=c.Flow=b_.Class({get_Render:function(){return this.render;}},k,bN);bN.New=b_.Ctor(function(ct){bN.New$1.call(this,function(cu){return function(cv){return A.Set(cu,ct(cv));};});},bN);bN.New$1=b_.Ctor(function(ct){k.New.call(this);this.render=ct;},bN);bN.get_Do=function(){return new bO.New();};bN.Static=function(ct){return new bN.New$1(function(cu){return function(cv){A.Set(cu,ct);return cv();};});};bN.Define=function(ct){return new bN.New(function(cu){return ct(function(cv){cu(cv);});});};bN.Embed=function(ct){var cu;cu=A.Create$1(bG.get_Empty());((ct.get_Render())(cu))(a.ignore);return bG.EmbedView(cu.get_View());};bN.Return=function(ct){return new bN.New$1(function(){return function(cu){return cu(ct);};});};bN.Bind=function(ct,cu){return new bN.New$1(function(cv){return function(cw){return((ct.get_Render())(cv))(function(cx){((cu(cx).get_Render())(cv))(cw);});};});};bN.Map=function(ct,cu){return new bN.New$1(function(cv){return function(cw){return((cu.get_Render())(cv))(function(cx){cw(ct(cx));});};});};bO=c.FlowBuilder=b_.Class({ReturnFrom:a.id,Return:function(ct){return bN.Return(ct);},Bind:function(ct,cu){return bN.Bind(ct,cu);}},k,bO);bO.New=b_.Ctor(function(){k.New.call(this);},bO);bQ=bP.attr=b_.Class({},k,bQ);bQ.New=b_.Ctor(function(){k.New.call(this);},bQ);bR.InstallHash=function(ct,cu){var cv;cv=A.Create$1(void 0);bR.InstallHashInto(cv,ct,cu);return cv;};bR.InstallHashInto=function(ct,cu,cv){function cw(cz){return cp.Parse(cv,cq.FromHash(cz,{$:1,$0:true}));}function cx(){return bR.getCurrentHash(cw,cu);}function cy(cz){if(!b$.Equals(ct.Get(),cz))ct.Set(cz);}cy(cx());self.addEventListener("popstate",function(){return cy(cx());},false);self.addEventListener("hashchange",function(){return cy(cx());},false);self.document.body.addEventListener("click",function(cz){var cA,cB,cC;cA=(cB=bR.findLinkHref(cz.target),cB==null?null:(cC=cB.$0,b5.StartsWith(cC,"#")?cw(cC):null));return cA==null?null:(cy(cA.$0),cz.preventDefault());},false);y.Sink(function(cz){var cA;if(!b$.Equals(cz,cx())){cA=cp.HashLink(cv,cz);self.history.pushState(null,null,cA);}},ct.get_View());};bR.getCurrentHash=function(ct,cu){var cv,cw;cv=self.location.hash;cw=ct(cv);return cw==null?((function(cx){return function(cy){return cx("Failed to parse route: "+cr.toSafe(cy));};}(function(cx){ca.log(cx);}))(cv),cu):cw.$0;};bR.Install=function(ct,cu){var cv;cv=A.Create$1(void 0);bR.InstallInto(cv,ct,cu);return cv;};bR.InstallInto=function(ct,cu,cv){function cw(cz){return cp.Parse(cv,cz);}function cx(){return bR.getCurrent(cw,cu);}function cy(cz){if(!b$.Equals(ct.Get(),cz))ct.Set(cz);}cy(cx());self.addEventListener("popstate",function(){return cy(cx());},false);self.document.body.addEventListener("click",function(cz){var cA,cB,cC;cA=(cB=(cC=bR.findLinkHref(cz.target),cC==null?null:bR.hrefToAbsolute(cC.$0)),cB==null?null:cw(cq.FromUrl(cB.$0,null)));return cA==null?null:(cy(cA.$0),cz.preventDefault());},false);y.Sink(function(cz){var cA;if(!b$.Equals(cz,cx())){cA=cp.Link(cv,cz);self.history.pushState(null,null,cA);}},ct.get_View());};bR.findLinkHref=function(ct){while(true)if(ct.tagName=="A")return cs.ofObj(ct.getAttribute("href"));else if(ct===self.document.body)return null;else ct=ct.parentNode;};bR.hrefToAbsolute=function(ct){var cu;return b5.StartsWith(ct,"?")?{$:1,$0:bR.trimFragment(self.location.pathname+ct)}:b5.StartsWith(ct,"#")?null:b5.StartsWith(ct,"/")?{$:1,$0:bR.trimFragment(ct)}:(new a.RegExp("^[a-zA-Z0-9]:")).test(ct)?null:(cu=self.location.pathname,{$:1,$0:bR.trimFragment(cn.string(cu,null,{$:1,$0:cu.lastIndexOf("/")})+ct)});};bR.trimFragment=function(ct){var cu;cu=ct.indexOf("#");return cu===-1?ct:cn.string(ct,null,{$:1,$0:cu-1});};bR.getCurrent=function(ct,cu){var cv,cw,cx;cv=self.location;cw=cq.FromUrl(cv.pathname+cv.search,null);cx=ct(cw);return cx==null?((function(cy){return function(cz){return cy("Failed to parse route: "+cr.toSafe(cz));};}(function(cy){ca.log(cy);}))(cw.ToLink()),cu):cx.$0;};bS.Append=function(ct,cu){return{$:0,$0:p.Append(ct.$0,cu.$0),$1:cc.FoldBack(function(cv,cw,cx){return cx.Add$1(cv,cw);},ct.$1,cu.$1)};};bS.FromList=function(ct,cu){return{$:0,$0:p.FromArray(b3.ofList(ct)),$1:cu};};bS.ToList=function(ct){return[b2.ofArray(p.ToArray(ct.$0)),ct.$1];};bS.SameHash=function(ct,cu){return bS.NoHash(ct)==bS.NoHash(cu);};bS.MakeHash=function(ct){var cu,cv;cu=ct.$1;cv=b5.concat("/",b3.map(function(cw){return a.encodeURIComponent(cw);},p.ToArray(ct.$0)));return cu.get_IsEmpty()?cv:cv+"?"+b5.concat("&",b9.map(function(cw){var cx;cx=ce.KeyValue(cw);return a.encodeURIComponent(cx[0])+"="+a.encodeURIComponent(cx[1]);},cu));};bS.ParseHash=function(ct){var cu,cv,cw,cx;cu=bS.NoHash(ct);cv=(cw=cu.indexOf("?"),cw===-1?[cu,""]:[cn.string(cu,null,{$:1,$0:cw-1}),cn.string(cu,{$:1,$0:cw+1},null)]);cx=cv[0];return{$:0,$0:p.FromArray(cx==""?[]:b3.map(function(cy){return a.decodeURIComponent(cy);},b5.SplitChars(cx,["/"],0))),$1:cc.OfArray(b3.map(function(cy){var cz;cz=cy.indexOf("=");return cz===-1?[a.decodeURIComponent(cy),""]:[a.decodeURIComponent(cn.string(cy,null,{$:1,$0:cz-1})),a.decodeURIComponent(cn.string(cy,{$:1,$0:cz+1},null))];},b5.SplitChars(cv[1],["&"],0)))};};bS.NoHash=function(ct){return b5.StartsWith(ct,"#")?ct.substring(1):ct;};bT.DoLink=function(ct,cu){var cv;cv=ct.Ser(cu);return bS.FromList(cv[0],cv[1]);};bT.DoRoute=function(ct,cu){return ct.Des(bS.ToList(cu));};bT.InstallMap=function(ct){var cu;function cv(cz,cA){return b$.Equals(ct.Ser(cz),ct.Ser(cA));}function cw(){return ct.Des(bS.ToList(bS.ParseHash(self.location.hash)));}function cx(cz){if(!cv(cu.Get(),cz))cu.Set(cz);}function cy(cz){return cx(cw());}cu=A.Create$1(cw());self.onpopstate=cy;self.onhashchange=cy;y.Sink(function(cz){var cA,cB;cA=bS.MakeHash((cB=ct.Ser(cz),bS.FromList(cB[0],cB[1])));if(!bS.SameHash(self.location.hash,cA))self.location.replace("#"+cA);},cu.get_View());return cu;};bU.Install=function(ct){return bT.InstallMap(ct);};bU.Create=function(ct,cu){function cv(cw){return cw[0];}return{Des:function(cw){return cu(cv(cw));},Ser:function(cw){return[ct(cw),new cd.New([])];}};};bU.CreateWithQuery=function(ct,cu){return{Des:cu,Ser:ct};};bW.New=function(ct,cu){return{Active:ct,PosV:cu};};bX.New=function(ct,cu,cv,cw){return{Active:ct,Left:cu,Middle:cv,Right:cw};};bY.get_MousePressed=function(){bV.ActivateButtonListener();return y.Apply(y.Apply(y.Apply(y.Const(b_.Curried3(function(ct,cu,cv){return ct||cu||cv;})),bV.MouseBtnSt$1().Left.get_View()),bV.MouseBtnSt$1().Middle.get_View()),bV.MouseBtnSt$1().Right.get_View());};bY.get_RightPressed=function(){bV.ActivateButtonListener();return bV.MouseBtnSt$1().Right.get_View();};bY.get_MiddlePressed=function(){bV.ActivateButtonListener();return bV.MouseBtnSt$1().Middle.get_View();};bY.get_LeftPressed=function(){bV.ActivateButtonListener();return bV.MouseBtnSt$1().Left.get_View();};bY.get_Position=function(){!bV.MousePosSt$1().Active?(self.document.addEventListener("mousemove",function(ct){return A.Set(bV.MousePosSt$1().PosV,[ct.clientX,ct.clientY]);}),bV.MousePosSt$1().Active=true):void 0;return bV.MousePosSt$1().PosV.get_View();};bZ.New=function(ct,cu,cv){return{KeysPressed:ct,KeyListenerActive:cu,LastPressed:cv};};b0.IsPressed=function(ct){function cu(cv){return cv===ct;}bV.ActivateKeyListener();return y.Map(function(cv){return b2.exists(cu,cv);},bV.KeyListenerState().KeysPressed.get_View());};b0.get_LastPressed=function(){bV.ActivateKeyListener();return bV.KeyListenerState().LastPressed.get_View();};b0.get_KeysPressed=function(){bV.ActivateKeyListener();return bV.KeyListenerState().KeysPressed.get_View();};bV.ActivateKeyListener=function(){b1.$cctor();return b1.ActivateKeyListener;};bV.KeyListenerState=function(){b1.$cctor();return b1.KeyListenerState;};bV.ActivateButtonListener=function(){b1.$cctor();return b1.ActivateButtonListener;};bV.MouseBtnSt$1=function(){b1.$cctor();return b1.MouseBtnSt;};bV.MousePosSt$1=function(){b1.$cctor();return b1.MousePosSt;};b1.$cctor=function(){b1.$cctor=a.ignore;function ct(cu,cv){var cw;cw=cu.button;return cw===0?A.Set(bV.MouseBtnSt$1().Left,cv):cw===1?A.Set(bV.MouseBtnSt$1().Middle,cv):cw===2?A.Set(bV.MouseBtnSt$1().Right,cv):null;}b1.MousePosSt=bW.New(false,A.Create$1([0,0]));b1.MouseBtnSt=bX.New(false,A.Create$1(false),A.Create$1(false),A.Create$1(false));b1.ActivateButtonListener=!bV.MouseBtnSt$1().Active?(bV.MouseBtnSt$1().Active=true,self.document.addEventListener("mousedown",function(cu){return ct(cu,true);}),self.document.addEventListener("mouseup",function(cu){return ct(cu,false);})):null;b1.KeyListenerState=bZ.New(A.Create$1(b2.T.Empty),false,A.Create$1(-1));b1.ActivateKeyListener=!bV.KeyListenerState().KeyListenerActive?(bV.KeyListenerState().KeyListenerActive=true,self.document.addEventListener("keydown",function(cu){var cv,cw,cx;cv=cu.which;cw=cv===null?cu.keyCode:cv;A.Set(bV.KeyListenerState().LastPressed,cw);cx=bV.KeyListenerState().KeysPressed.Get();return!b2.exists(function(cy){return cy===cw;},cx)?bV.KeyListenerState().KeysPressed.Set(b2.append(cx,b2.ofArray([cw]))):null;}),self.document.addEventListener("keyup",function(cu){var cv,cw;function cx(cy){return cy!==cw;}cv=cu.which;cw=cv===null?cu.keyCode:cv;return A.Update(bV.KeyListenerState().KeysPressed,function(cy){return b2.filter(cx,cy);});})):null;};}(self));
